<HTML>
<HEAD>
<TITLE>  Extracion de datos de pagos BNC  </TITLE>
<!-- <link rel="stylesheet" href="styles.css" > -->
<link rel="manifest" href="manifest.json">
<!-- <meta charset="iso-8859-1">  -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
<style>

input[type=number]{
font-size:2em;
width: 8em;
border: 2px solid red;
border-radius: 4px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
  background-color: #3CBC8D;
  color: red;

}

input[type=text]{
font-size:1em;
width: 10em;
border: 2px solid red;
border-radius: 4px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
  background-color: white;
  color: black;
}

input[type=email]{
font-size:1em;
width: 8em;
border: 2px solid red;
border-radius: 4px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
  background-color: #3CBC8D;
  color: red;
}

input[type=date]{
font-size:1em;
width: 12em;
border: 2px solid red;
border-radius: 4px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
   background-color: #3CBC8D;
  
  color: black;
}

select{
font-size:1em;
width: 10em;
border: 2px solid red;
border-radius: 8px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
  background-color: #3CBC8D;
  color: red;
}

input[type=text]:focus {
  background-color: lightblue;
}


</style>
<style>
body {
  font-family: "Lato", sans-serif;
}

.sidenav {
  height: 100%;
  width: 0;
  position: fixed;
  z-index: 1;
  top: 0;
  left: 0;
  background-color: #111;
  overflow-x: hidden;
  transition: 0.5s;
  padding-top: 60px;
  text-align:left;
}

.sidenav a {
  padding: 8px 8px 8px 32px;
  text-decoration: none;
  font-size: 25px;
  color: #818181;
  display: block;

  transition: 0.8s;
}

.sidenav a:hover {
  color: #f1f1f1;
}

.sidenav .closebtn {
  position: absolute;
  top: 0;
  right: 25px;
  font-size: 36px;
  margin-left: 50px;
}

@media screen and (max-height: 450px) {
  .sidenav {padding-top: 15px;}
  .sidenav a {font-size: 18px;}
}

.micro {
   background-image:url(microphone.svg);
   width:30px;
	height:30px;
	font-size:16px;
	padding:0px 0px 0px 0px;
	background-size:30px 30px;
	background-position:-2px 0px;
    fill: green;

border-radius: 8px;
}
.divfondo {
   width:90%;
   background-color:#FFFDD0;
   border-radius: 8px;
padding: 6px 6px;
margin-left: 5px;
margin-right: 5px;
}
.micro:active {
background-color: lightgreen;
}
.btop{
font-size:2em;
border: 2px solid red;
border-radius: 8px;
padding: 4px 4px ;
  margin: 4px 0px ;
  box-sizing: border-box;
  background-color: orange;
  color: black;
}
.btop:active {background-color: lightgreen;}
.titulo{
color:blue;
}
.botonf{
font-size:0.8em;
border: 2px solid red;
border-radius: 4px;
padding: 8px 8px;
  margin: 8px 0;
  box-sizing: border-box;
  background-color: oldlace;
  color: black;
}
.tablefact {
padding: 0px 0px;
margin: 0px 0px;
font-size: 1em;
}
.botonfact{
width:20em;
font-size:0.8em;
text-align:left;
border: 2px solid red;
border-radius: 12px;
padding: 8px 8px;
  margin: 8px 0;
  box-sizing: border-box;
  background-color: #FFFDD0;
  color: black;
}
.botonf:active {background-color: lightgreen;}
.botonfact:active {background-color: lightgreen;}

#divdata {
position:fixed;
top:20%;
height: 70%;
width:95%;
overflow-y: scroll;
}

#footer {
  display: none;
  position: fixed;
  left: 0;
  bottom: 0;
  width: 100%;
  background-color: blue;
  color: white;
  text-align: center;
  font-size:0.5em;
}
#menu {
  position: fixed;
  left: 0;
  top: 8%;
  width: 100%;
  background-color: white;
  color: white;
  text-align: center;
  font-size:0.5em; 
  visibility:visible;
}
#header {
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  background-color: white;
  color: white;
  text-align: center;
  font-size:0.5em;
}
#div3 {
  position: fixed;
  left: 0;
  top: 90%;
  width: 100%;
  background-color: white;
  color: black;
  text-align: center;
  font-size:1em;
}
</style>
</HEAD>

<script type="text/javascript" src="selectFile.js"></script>

<script type="text/javascript">
const t_c=new Map();
Fecha_hora='';
t_c.set('584144202172','Alejandro Naranjo');
t_c.set('01020406290000103046','Alianza cafe');
t_c.set('584124067144','Ana Beatriz sobrina');
t_c.set('584244244676','Ana Luisa Caldera');
t_c.set('584126153631','Anderson Pita');
t_c.set('584144853637','Andres Mijares');
t_c.set('AREPA EL PAISITA','AREPA EL PAISITA');
t_c.set('01740124621244237572','AREPA EL PAISITA');
t_c.set('01910027801127274106','Armando Pita');
t_c.set('584125012908','Bodega Felix');
t_c.set('584144973532','Bodega Marcos');
//t_c.set('584244541829','Bodega Moya');
t_c.set('584244469305','Bodega Moya');
t_c.set('584244285516','Bodega Moya');
t_c.set('01140162731620081589','Bodegon JR');
t_c.set('584242069117','Bodegon JR');
t_c.set('584144033621','Bodegon JR');
t_c.set('584125091226','Bodegon JR');
t_c.set('584128552592','Braulio De Abreu');
t_c.set('584244021067','Bull buja');
t_c.set('584144791658','Bull Pen Joselyn');
t_c.set('584140412168','Bull Pen');
t_c.set('584244063691','Bull Pen');
t_c.set('584145822722','Canapiale');
t_c.set('584141863212','Canapiale');
t_c.set('584128529762','Carlos Hernandez');
t_c.set('584124346526','Carlos Hernandez');
t_c.set('584144978575','Carlos Hernandez');
t_c.set('584127848852','Carlos Hernandez');
t_c.set('584145936335','Carlos Hernandez');
t_c.set('584124500070','Carlos Hernandez');
t_c.set('584124336110','Carlos Hernandez');
t_c.set('584140487771','Carlos Hernandez');
//t_c.set('01050041981041334605','Carlos Hernandez');
t_c.set('584125026326','Carlos Hernandez');
t_c.set('584124544871','Carlos Hernandez');
t_c.set('584128314388','Carn. la Embocada');
t_c.set('01910243272100053204','Carn. la Embocada');
t_c.set('584244392499','Luncheria Malave Carolina');
t_c.set('584121396715','Casa Mayor');
t_c.set('01910148722100041321','Centeno Wilmer');
t_c.set('01050758831758117052','Churumal');
t_c.set('584124548273','Ciudad Market');
t_c.set('01340419414191032727','Club la emboscada');
t_c.set('01340419414193020946','Club la emboscada');
t_c.set('584124304844','Colegio los pinos');
t_c.set('584125100639','Colegio Teresiano');
t_c.set('584149479895','Darley De Abreu');
t_c.set('584148737746','Denis Supervisor');
t_c.set('584146784460','El chivato Rosa');
t_c.set('584140430489','El sabor de Lili');
t_c.set('584124613036','El sazon de la Abuela');
t_c.set('01020857280000164412','El sazon de la Abuela')
t_c.set('584149487610','Igual que en casa')
t_c.set('01080923150100080735','Rincon Italiano')
t_c.set('584143419930','Panaderia hogar pan')
t_c.set('584244988456','Cesar Perrero Paveca')
t_c.set('584144791429','Esposa de Ludi');
t_c.set('01380008190080143008','Euro Licores');
t_c.set('01680052095101387169','Euro Licores');
t_c.set('584144408427','Euro Licores');
t_c.set('01910148792100048675','Garcia T. Antonio J.');
t_c.set('584142487797','Guaicamari');
t_c.set('584244078576','Guaicamari');
t_c.set('01340791657911005013','Guaicamari');
t_c.set('584144390582','Haydee Martinez');
t_c.set('584145936061','Heladeria Unica');
t_c.set('01910243222100017346','Heladeria Unica');
t_c.set('HOTEL GOLD','Hotel Gold Parade');
t_c.set('584244188209','Lo mejor del toco');
//t_c.set('584244021067','Inversiones del Valle');// Bull buja
t_c.set('01050041981041334605','Keny Pita');

t_c.set('584122853554','La cuna la negra');
t_c.set('584128311132','La cuna la negra');
t_c.set('584144202063','La cuna la negra');
t_c.set('584128568459','La Ermita');
t_c.set('01020152720000574471','La Ermita');
t_c.set('01020142000100004572','La luz');
t_c.set('01910027812127041189','Leticia');
t_c.set('584145939707','Lic Felix Yorman');
t_c.set('584124203948','Lic. San Rafael');
t_c.set('584124203947','Lic. San Rafael');
t_c.set('01340464034643019505','Liconan');
t_c.set('01740124661244144208','Liconan');
t_c.set('584144807588','Liconan');
t_c.set('584244342559','Liconan');
t_c.set('584121401869','Licoreria Baco');
t_c.set('01340346533461027171','Licoreria Baco');
t_c.set('584140459037','Luncheria Unicasa');
t_c.set('584144145440','Licoreria Malave');// Simon
t_c.set('584124072605','Abastos Malave Claudia');// Claudia
t_c.set('01910027821127272510','Martinez B. Antonio');
t_c.set('01020857200000136026','Materiales Alianza');
t_c.set('01020114420000595059','Materiales Alianza');
t_c.set('01020114420000585059','Materiales Alianza');
t_c.set('IGRIVAL','Materiales Alianza');
t_c.set('584124097520','Maximum Carnes');
t_c.set('01020430580000079701','Maximum Carnes');
t_c.set('01020152750000507309','Mc Center Pool');
t_c.set('01380008190085381160','Mc Center Pool');
t_c.set('01380008120080196594','Mc Center Pool');
t_c.set('584144063036','Mary Pita');
t_c.set('584127820477','Negro Primero');
t_c.set('584140389048','Negro Primero');
t_c.set('584244069799','Negro Primero');
t_c.set('01910148722100062413','Negro Primero');
t_c.set('584144185616','Pan Center');
t_c.set('01910203342100024431','Panaderia la Unidad 2012');
t_c.set('01910203382100035457','Francis pan');
t_c.set('01690002881000458707','Pan. Trigo Pan SRL');
t_c.set('TRIGOPAN','Pan. Trigo Pan SRL');
t_c.set('584167465405','Panaderia Renacer');
t_c.set('584126903878','Peluquero Roro');
t_c.set('PEPSI COLA','PEPSI COLA');
t_c.set('01140226742260075694','Piedra pintada');
t_c.set('01380008100080137300','Piedra pintada');
t_c.set('01340419414191041936','Piedra pintada');
t_c.set('584144314028','Quiosco Sara');
t_c.set('584123441007','Rafael Pita');
t_c.set('584148944498','Rafael Pita');
t_c.set('CREACIONES PITA','Rafael Pita');
t_c.set('584128808329','Rest. Pio pio');
t_c.set('01910369212100007816','Rest. Pio pio');
t_c.set('01910362502100027278','Rest. Pio pio');
t_c.set('01080083840100274933','Rest. Pio pio');
t_c.set('01340592135921000679','Vama Cafe');
t_c.set('584244541829','Roger Dona');
t_c.set('01750062720073634371','Rosa De Abreu');
t_c.set('584124566786','Sazon de la abuela');
t_c.set('584144397087','Tequenack');
t_c.set('01340419444191042090','Venvidrio');
t_c.set('584144159903','Venvidrio');
t_c.set('584120386419','Venvidrio');
t_c.set('584121589089','La gran parada');// Vicente
t_c.set('584144125422','Vilmar');
t_c.set('01080927480100022435','Vikingo');
t_c.set('584129546298','Kiosko Hospital');
t_c.set('584124465846','Yoni el cauchero');
t_c.set('584244030883','Energym Coffe');
t_c.set('01050137711137023074','Maxi Carnes Vigirima');
t_c.set('584146443242','Farmacia Sunacar');


dat_especial=["AREPA EL PAISITA","IGRIVAL","HOTEL GOLD","TRIGOPAN","PEPSI COLA","CREACIONES PITA"];
const t_d=new Map();
/*t_d.set('27/12/2022',16.57);
t_d.set('26/12/2022',16.57);
t_d.set('25/12/2022',16.45);
t_d.set('24/12/2022',16.45);
t_d.set('23/12/2022',16.45);
t_d.set('22/12/2022',16.18);
*/
var productos=[];



function Activalector_archivos(){
getFile2 = new selectFile;
getFile2.targets('choose2','selected');
archivos2=document.getElementById('choose2');
archivos2.value=null;
archivos2.addEventListener('change', Leer_Archivo, false);
getFile2.simulate();
}


function readFileAsText(file){
  return new Promise(function(resolve,reject){
  let fr = new FileReader();
  fr.onload = function(){
     resolve(fr.result);
   };
   fr.onerror = function(){
     reject(fr);
   };
   fr.readAsText(file);
   });
}
//function Leer_Archivo(e){}

function Leer_Archivo(e){
 var archivos=e.currentTarget.files;
var narch=archivos.length;
let readers=[];
 for(var f=0;f<narch;f++){
  readers.push(readFileAsText(archivos[f]));
 
  //console.log('nombre archivo'+archivos[f].lastModifiedDate);
  Fecha_hora=archivos[f].lastModifiedDate.toLocaleString('es-US',{});
 } 
 Promise.all(readers).then((values) => {
  var sep="&&&&";
  contenido='';
  for(var t=0;t<narch;t++){
     if (t!=0) {contenido+=sep+values[t]} else {contenido+=values[t];}
     }
 console.log(contenido);
     procesa_contenido();
 });

}
var contenido='';
function procesa_archivo(e){
//contenido=e.target.result; 
//localStorage.setItem('Arch_datos_banco',contenido);
//procesa_contenido();
}

function fecha_mayor_igual(f1,f2){
var a2=f2.split('/');
var a1=f1.split('/');
 if (a2[2]>a1[2] || (a2[2]==a1[2] && a2[1]>a1[1]) || (a2[2]==a1[2] && a2[1]==a1[1]) && a2[0]>a1[0]) {return false; } else {return true;}
}

function muestra(num){
var texto='';
var div3=document.getElementById("div3");
texto+=pagos[num].motivo;
div3.innerHTML=texto;
}

function genera_salida1(){
if (pagos.length>0) {
var divaux=document.getElementById("divdata");
var texto='';
pagos.sort(ordena_pagos);
var fecha_previa=pagos[0].fecha;
var nombre_previo=pagos[0].nombre;
//var total_parcial=parseFloat(pagos[0].montodolar);
var total_parcial=0;

console.log('Fecha: '+fecha_previa+' Dolar BCV: '+pagos[0].dolar+' $');
texto+='<p style="text-align:center;font-size:1.5em;">'+'Fecha: '+fecha_previa+' Dolar BCV: '+pagos[0].dolar+' $'+'</p>';
texto+='<table width="100%">';

for (var i=0;i<pagos.length;i++){
 if (pagos[i].tc=='A') {colb='SkyBlue';} else {colb='DodgerBlue';}
// console.log('i: '+i);
 if (pagos[i].fecha!=fecha_previa) {
    fecha_previa=pagos[i].fecha;
    console.log('Fecha: '+fecha_previa+' Dolar BCV: '+pagos[i].dolar+' $');
    texto+='</table>';
    texto+='<p style="text-align:center;font-size:1.5em;">'+'Fecha: '+fecha_previa+' Dolar BCV: '+pagos[i].dolar+' $'+'</p>';

    texto+='<table width="100%">';
  }
//  console.log(pagos[i].fecha+' '+pagos[i].telf+' '+pagos[i].montoBs+' Bs '+pagos[i].montodolar+' $ '+pagos[i].nombre);

//texto+='<tr><td>'+pagos[i].hora.substring(0,5)+'</td><td>'+pagos[i].telf+'</td><td>'+pagos[i].montoBs+' Bs '+'</td><td>'+pagos[i].montodolar+' $ '+'</td><td>'+pagos[i].nombre+'</td></tr>';
texto+='<tr onclick="muestra('+i+')"; style="background-color:'+colb+';"><td>'+pagos[i].nombre+'</td><td>'+pagos[i].montoBs+' Bs '+'</td><td>'+pagos[i].montodolar+' $ '+'</td></tr>';

}
 texto+='</table>';
divaux.innerHTML=texto;
divaux.style.visibility="visible";
}
}


function genera_salida2(){
if (pagos.length>0) {
var divaux=document.getElementById("divdata");
var texto='';
 pagos.sort(ordena_pagos2);
var nombre_previo='';
var fecha_previa=pagos[0].fecha;
var total_parcial=0;
var montop='';
 console.log( nombre_previo);
texto+='<p style="color:red;font-size:1.5em;text-align:center;">'+nombre_previo+'</p>';
for (var i=0;i<pagos.length;i++){
    if (pagos[i].tc=='A') {colb='SkyBlue';} else {colb='DodgerBlue';}

 if (pagos[i].nombre!=nombre_previo) {
    
    nombre_previo=pagos[i].nombre;
    if (i!=0) {
      console.log(total_parcial.toFixed(2));
     texto+='<p style="color:blue;">Fecha:'+fecha_previa+'Total parcial: '+montop.toFixed(2)+'</p>';
      fecha_previa=pagos[i].fecha;texto 
      texto+='<p>Total: '+total_parcial.toFixed(2)+'</p>';
    }

    total_parcial=parseFloat(pagos[i].montodolar);
     montop=total_parcial;
    console.log(pagos[i].nombre);
    texto+='<p style="color:red;font-size:1.5em;text-align:center;">'+pagos[i].nombre+'</p>';
 
 } else { 
    total_parcial+=parseFloat(pagos[i].montodolar)
    if (pagos[i].fecha!=fecha_previa) { 
       texto+='<p style="color:blue;"> Fecha:'+ fecha_previa+'Total parcial: '+montop.toFixed(2)+'</p>'; montop=parseFloat(pagos[i].montodolar)
       fecha_previa=pagos[i].fecha; 
     }  else  {
        montop+=parseFloat(pagos[i].montodolar);
        }
  }
console.log(pagos[i].fecha+' '+pagos[i].telf+' '+pagos[i].montoBs+' Bs '+pagos[i].montodolar+' $ ');
//texto+='<p>'+pagos[i].fecha+' '+pagos[i].hora.substring(0,5)+' '+pagos[i].telf+' '+pagos[i].montoBs+' Bs '+pagos[i].montodolar+' $ '+'</p>';
texto+='<p style="background-color:'+colb+';">'+pagos[i].fecha+' '+pagos[i].hora+' '+pagos[i].montoBs+' Bs '+pagos[i].montodolar+' $ '+'</p>';
} // for i

 console.log(total_parcial.toFixed(2));
 texto+='<p>Fecha:'+fecha_previa;+'Total parcial: '+montop.toFixed(2)+'</p>';
     

texto+='<p>Total :'+total_parcial.toFixed(2)+'</p>';
divaux.innerHTML=texto;
divaux.style.visibility="visible";
}
}

function genera_salida3(){
if (pagos.length>0) {
var divaux=document.getElementById("divdata");
var texto='';
 pagos.sort(ordena_pagos3);
var fecha_previa=pagos[0].fecha;
var nombre_previo=pagos[0].nombre;
var total_parcial=0;

console.log('Fecha: '+fecha_previa+' Dolar BCV: '+pagos[0].dolar+' $');
texto+='<p style="text-align:center;font-size:1.5em;">'+'Fecha: '+fecha_previa+' Dolar BCV: '+pagos[0].dolar+' $'+'</p>';
texto+='<table width="100%">';
for (var i=0;i<pagos.length;i++){
   if (pagos[i].tc=='A') {colb='SkyBlue';} else {colb='DodgerBlue';}

 if (pagos[i].fecha!=fecha_previa) {
    fecha_previa=pagos[i].fecha;
    console.log('Fecha: '+fecha_previa+' Dolar BCV: '+pagos[i].dolar+' $');
    texto+='</table>';
    texto+='<p style="text-align:center;font-size:1.5em;">'+'Fecha: '+fecha_previa+' Dolar BCV: '+pagos[i].dolar+' $'+'</p>';

    texto+='<table width="100%">';
  }
  console.log(pagos[i].fecha+' '+pagos[i].telf+' '+pagos[i].montoBs+' Bs '+pagos[i].montodolar+' $ '+pagos[i].nombre);
//texto+='<tr><td>'+pagos[i].hora.substring(0,5)+'</td><td>'+pagos[i].telf+'</td><td>'+pagos[i].montoBs+' Bs '+'</td><td>'+pagos[i].montodolar+' $ '+'</td><td>'+pagos[i].nombre+'</td></tr>';
texto+='<tr  onclick="muestra('+i+')"; style="background-color:'+colb+';"><td>'+pagos[i].nombre+'</td><td>'+pagos[i].montoBs+' Bs '+'</td><td>'+pagos[i].montodolar+' $ '+'</td></tr>';

}
 texto+='</table>';
divaux.innerHTML=texto;
divaux.style.visibility="visible";
}
}


var Tipocuenta='';

function caso_especial(dato){
 var post;
 console.log('Caso especial');
for (var i=0;i<dat_especial.length;i++) {
  post=dato.indexOf(dat_especial[i]);
  console.log('post '+ post);
  if (post>0) {return dat_especial[i];}
 }
return dato;
}
var posi=0;
var pagos=[];
var TC;
function procesa_contenido(){

function cumple1(value) {
if (value.indexOf("Abono Pago Movil")>0||value.indexOf("Credito Inmediato Recibido")>0 || (value.indexOf("TRANSFERENCIA RECIBIDA")>0 && value.indexOf("DE LA CUENTA NRO. 01910027801127274106")<0 ) ) {return true;} else {return false;}
}
var nsem;
var sem;

//console.log(contenido);
var archivos=contenido.split("&&&&");

for (var jj=0;jj<archivos.length;jj++) {
var lineas=archivos[jj].split("\r\n");

 var post=lineas[0].indexOf('01910027801127274106');
if (post>=0) {Tipocuenta="Cuenta de Ahorro"; TC='A';}
 var post=lineas[0].indexOf('01910027822127000477');
if (post>=0) {Tipocuenta="Cuenta Juridica";TC='J';}

var result=lineas.filter(cumple1)
//console.log(result);


for (var i=posi;i<(posi+result.length);i++){
  var campos=result[i-posi].split('\t');
  pagos[i]=new Object();
  pagos[i].fecha=campos[0];
  pagos[i].hora=campos[1];
  pagos[i].ref=campos[2];
  pagos[i].motivo=campos[6];
  pagos[i].tc=TC;
  var telfn=campos[6];
 pagos[i].telf=telfn;
console.log(pagos[i].telf);
  var post=telfn.indexOf('CTA');
  //console.log(post + 'CTA');
  //console.log('post '+post);
  if (post>0) {pagos[i].telf=telfn.substring(post+5,post+26);console.log(pagos[i].telf);}
    else {
     post=telfn.indexOf('TELF'); console.log(post + 'TELF');
     if (post>=0) {
       pagos[i].telf=telfn.substring(post+6,post+18)
     } else
      {
       post=telfn.indexOf('CUENTA NRO'); console.log(post + 'Cuenta nro');
       if (post>=0) {pagos[i].telf=telfn.substring(post+12,post+32);console.log(pagos[i].telf);}
         else {

          post2=result[i-posi].indexOf('Abono por Creditos Directos');

post=result[i-posi].indexOf('TRANSFERENCIA RECIBIDA');

          if (post>=0 || post2>=0) { pagos[i].telf=caso_especial(telfn); }

         } 

      }
  }
 
  pagos[i].montoBs=parseFloat(campos[8].replace(',', '.'));
  var clave=(pagos[i].telf).toString().trim();
  pagos[i].nombre=t_c.get(clave);
  if (pagos[i].nombre==undefined) {pagos[i].nombre=clave;}
  var clave_fecha=pagos[i].fecha.toString();
  console.log('clave_fecha'+clave_fecha+' '+clave_fecha.length);
  pagos[i].dolar=t_d.get(clave_fecha);
  if (pagos[i].dolar!=undefined) {
   pagos[i].montodolar=(pagos[i].montoBs/pagos[i].dolar).toFixed(2);
  } else {pagos[i].montodolar=0}
}
document.getElementById("t_c").innerHTML=Tipocuenta+'<br>'+Fecha_hora;;
//genera_salida2();

//const unique = pagos.filter((item, index) => (pagos.indexOf(item) === index));
//pagos=unique;

//const dataArr = new Set(pagos);

//  pagos = [...dataArr];

let set= new Set( pagos.map( JSON.stringify ) )
pagos = Array.from( set ).map( JSON.parse );
posi=pagos.length;

}
localStorage.setItem('pagos_banco',JSON.stringify(pagos));
}

function borrar_datos(){
pagos=[];
localStorage.setItem('pagos_banco','');
}

function ordena_pagos(a, b) {
  if (!fecha_mayor_igual(a.fecha,b.fecha)) return -1;
  if (!fecha_mayor_igual(b.fecha,a.fecha)) return 1;
  if (a.fecha==b.fecha) {
     if (a.hora>b.hora) {return 1;} else{return -1;}
  } 

}

function ordena_pagos2(a, b) {
  if (a.nombre<b.nombre) return -1;
  if (a.nombre>b.nombre) return 1;
  if (a.nombre==b.nombre) {
  if (!fecha_mayor_igual(a.fecha,b.fecha)) return -1;
  if (!fecha_mayor_igual(b.fecha,a.fecha)) return 1;
    if (a.fecha==b.fecha) {
     if (a.hora>b.hora) {return 1;} else {return -1;}
   }
 }
}

function ordena_pagos3(a, b) {
 if (!fecha_mayor_igual(a.fecha,b.fecha)) return -1;
  if (!fecha_mayor_igual(b.fecha,a.fecha)) return 1;
  if (a.fecha==b.fecha) {
    console.log(a.nombre+' '+b.nombre);
    if (a.nombre<b.nombre) return -1; 
    if (a.nombre<b.nombre) return 1;
    if (a.nombre==b.nombre) {
     if (a.hora>b.hora) {return 1;} else {return -1;}
   }
 }
}
var textoreconocido;
function obtenerTexto(indice) {
if ( window.SpeechRecognition || window.webkitSpeechRecognition ) {
// Obtenemos el objeto de reconocimento de texto de forma compatible a diferentes navegadores
reconocimientoTexto = new ( window.SpeechRecognition || window.webkitSpeechRecognition ) ()
reconocimientoTexto.lang='es-Ve'; 
reconocimientoTexto.onerror = function(event) {
 alert("error "+event.error);
 textoreconocido="";
procesar2(indice);
}
reconocimientoTexto.onresult = function(event) {
// Mostramos el texto obtenido
textoreconocido=event.results[0][0].transcript;
console.log(textoreconocido);
procesar2(indice);
}
// Empezamos a reconocer texto
reconocimientoTexto.start();
} else {
alert ('El navegador no soporta reconocimiento de voz' );
}
}

function procesar2(ind){
var num=textoreconocido.split(" ");
var lt=num.length;
var cant='';
for (var i=0;i<lt;i++) {
 cant+=num[i];
}
console.log(cant);
if (ind==1) {divs_datos.getElementsByTagName("input")[1].value=cant;return;}
if (ind==2) {
 divs_datos.getElementsByTagName("input")[2].value=cant.substring(0,2);
 divs_datos.getElementsByTagName("input")[3].value=cant.substring(2);
return;}
 if (ind==3) {divs_datos.getElementsByTagName("input")[4].value=cant;return;}
if (ind==4) {divs_datos.getElementsByTagName("input")[5].value=cant;return;}
if (ind==5) {
 document.getElementById("nret").value=cant;
 set_n_ret();
return;}

}
function openNav() {
var texto='<a class="closebtn" onclick="closeNav()">&times;</a>';
  texto+='<a href="javascript:void(0)">About</a>';
  texto+='<a  href="javascript:void(0)" onclick="closeNav();Configurar();">Configuracion</a>';
  texto+='<a  href="javascript:void(0)" onclick="closeNav();Crea_datos();">Datos de retencion</a>';
  texto+='<a  href="javascript:void(0)" onclick="closeNav();hacerRetencion();">Hacer PDF</a>';
 document.getElementById("mySidenav").innerHTML=texto;
  document.getElementById("mySidenav").style.width = "250px";
}

function closeNav() {
  document.getElementById("mySidenav").style.width = "0";
}
//localStorage.setItem('p3',va);


/*
*/
//var divs_datos;
var contador;
const max_valor=200;
function inicio(){
Activalector_archivos();
descarga_historico();
//contenido=localStorage.getItem('Arch_datos_banco');
var texto=localStorage.getItem('pagos_banco')

if ( texto!='' && texto!=null) {pagos=JSON.parse(texto);} else {pagos=[];}
posi=pagos.length;
console.log(pagos);
}

function quitar(nombdiv){
var div=document.getElementById(nombdiv);
div.hidden=true;
}

function enviar_whatsapp(phone,text){
var url ='https://api.whatsapp.com/send?phone='+phone+'&text='+text;
console.log(url);
window.open(url);
}


function enviar_mail(){
var url ='mailto:brauliodeabreu@gmail.com?subject=Retenciones';
window.open(url);
}

 




function descarga_historico(){
var nomb="https://bdeabreu66.github.io/historico/historico.txt";
//var myHeaders = new Headers();
var myInit = { mode: 'cors' };
fetch(nomb,myInit)
        .then(ajaxPositiveD)
        .catch(showErrorD);

function ajaxPositiveD(response) {
      console.log('response.ok: ', response.ok);
      if(response.ok) {
        response.json().then(showResultD);
      } else {
        showErrorD('status code: ' + response.status);
      }
    }
 function showResultD(txt) {
       console.log('muestro respuesta: ', txt);
        Historico=txt;
   for (var i=0;i<Historico.length;i++) {
   t_d.set(Historico[i]["fecha"],(Historico[i]["bcv"]));
  }
  localStorage.setItem('HDOLAR',JSON.stringify(Historico));
  // procesa_contenido();
    }
function showErrorD(err) { console.log('muestor error', err); 
   Historico=JSON.parse(localStorage.getItem('HDOLAR'));
   for (var i=0;i<Historico.length;i++) {
   t_d.set(Historico[i]["fecha"],(Historico[i]["bcv"]));
  }
 procesa_contenido();
   }

}


// Registra el service worker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js').then(function(registration) {
      // Si es exitoso
      console.log('SW registrado correctamente');
    }, function(err) {
      // Si falla
      console.log('SW fallo', err);
    });
  });
}

</script>

<BODY onload="inicio();">
<!-- <div id="encabezado" style="text-align: left; border: 1px solid #999999; position: fixed;" >  -->
<!--<span style="font-size:30px;cursor:pointer; margin-left: 0px;text-align: left;" onclick="openNav()">&#9776; Menu </span>  -->
<!--</div>  -->
<div id="mySidenav" class="sidenav" ></div>

<div id="divdata"></div>
<div id="menu">
<span style="display:block;font-size:2em;color:red;" id="t_c">Prueba</span>
<button class="btop" onclick="genera_salida1();">Fecha</button>
<button class="btop" onclick="genera_salida2();">Cliente</button>
<button class="btop" onclick="genera_salida3();">Fecha-Cliente</button>
</div>
<div id="header"> 
<button class="btop" onclick="Activalector_archivos();">Cargar Datos V2</button>  
<button class="btop" onclick="borrar_datos();">Borrar Datos</button>
</div>

<div>
<label hidden id=selected>Nothing selected</label><br>
<input hidden type=file id="choose2" accept="*.txt" multiple>
</div>
<div id="div3">
</div>

</body>
</html>
