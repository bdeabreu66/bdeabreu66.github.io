<HTML>
<HEAD>
<TITLE>  Reporte de ubicacion</TITLE>
<!-- <link rel="stylesheet" href="styles.css" > -->
<!-- <link rel="manifest" href="manifest.json"> -->

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
<style>

body{
font-size:30px;
}
input[type=number]{
width: 3em;
}

#parada {
  border: 2px solid red;
  border-radius: 10%;
  font-size:0.5em;
  background-color: white;
}

#display {
  font-size:1.5 rem;
  background-color: white;
}

button {
font-size:1.5 rem;
border: 2px solid red;
border-radius: 15%;
background-color: lightgray;


}
.btop{

font-size:1.5 rem;
border: 2px solid red;
border-radius: 15%;
}

.btn2{

font-size:1em;

}


input[type=text]{
font-size:1em;
width: 8em;
border: 2px solid red;
border-radius: 4px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
  background-color: #3CBC8D;
  color: white;
}

input[type=text]:focus {
  background-color: lightblue;
}

.barra {
  font-size: 1.7em;
  text-align: left;
  margin: 5px auto;
  padding: 5px;
  max-width: 700px;
  background-color: white;
  text-align: center;
}
.parlist {
font-family: Arial, Helvetica, sans-serif;
font-size:1.5rem;
  border: 1px groove red;
  border-radius: 5%;

color:darkblue;
padding:2px;
margin:1px;
}

p{
font-size:1.5rem;
background-color:white;
color:white;
padding:0px;
margin:0px;

}
td{
font-size:1.5rem;
padding:5px;

text-align: center;
}


table{
margin:0px;
padding:0px;

}

#footer {
  position: fixed;
  left: 0;
  bottom: 0;
  width: 100%;
  background-color: blue;
  color: white;
  text-align: center;
  font-size:0.5em;
}

#tabla_h {
  font-size:1.5rem;
  border: red 2px solid;
  width:100%;
}

td {
  font-size:1.0rem;
}

#header {
  position: relative;
  left: 0;
  top: 0;
  width: 100%;
  background-color: blue;
  color: white;
  text-align: center;
  font-size:0.5em;
}
</style>

</HEAD>




<BODY onload="carga();">
<br>
<div>
<div width="100%" height="20%">
   <img src="logo.png" width="100%" height="20%">
</div>
 <div id="header"> <button class="btop" onclick="Despliega_Rutas();">Rutas</button>&nbsp&nbsp<button class="btop" onclick="Despliega_paradas();">Paradas</button></div>
 <div id="pos"></div>
<!--   -->
<div id="ruta"></div>
<div id="display"></div>
<div id="svg" style="display:none;"></div>
<div id="parada"></div>


<script type="text/javascript">
function carga(){
Pedir_Rutas();
}

var rutaactiva=0;
datos_ubic=[{"unidad":"U_1","lat":"","longi":""},
            {"unidad":"U_2","lat":"","longi":""},
           ];

datos_graf=[{"datos":[{"id":"P_27","cx":"795","cy":"773","r":"10"},
                      {"id":"P_28","cx":"731","cy":"710","r":"10"},
                      {"id":"P_29","cx":"678","cy":"674","r":"10"},
                      {"id":"P_30","cx":"625","cy":"637","r":"10"},
                      {"id":"P_31","cx":"576","cy":"605","r":"10"},
                      {"id":"P_32","cx":"463","cy":"516","r":"10"},
                      {"id":"P_33","cx":"365","cy":"499","r":"10"},
                      {"id":"P_34","cx":"342","cy":"471","r":"10"},
                      {"id":"P_35","cx":"279","cy":"449","r":"10"},
                      {"id":"P_36","cx":"284","cy":"413","r":"10"},
                      {"id":"P_37","cx":"272","cy":"371","r":"10"},
                      {"id":"P_38","cx":"246","cy":"297","r":"10"},
                      {"id":"P_39","cx":"184","cy":"206","r":"10"},
                      {"id":"P_40","cx":"183","cy":"140","r":"10"},
                      {"id":"P_41","cx":"222","cy":"253","r":"10"},
                      {"id":"P_42","cx":"219","cy":"301","r":"10"},
                      {"id":"P_43","cx":"246","cy":"372","r":"10"},
                      {"id":"P_44","cx":"258","cy":"416","r":"10"},
                      {"id":"P_45","cx":"247","cy":"477","r":"10"},
                      {"id":"P_46","cx":"308","cy":"497","r":"10"},
                      {"id":"P_47","cx":"336","cy":"526","r":"10"},
                      {"id":"P_48","cx":"451","cy":"541","r":"10"},
                      {"id":"P_49","cx":"551","cy":"624","r":"10"},
                      {"id":"P_50","cx":"612","cy":"661","r":"10"},
                      {"id":"P_51","cx":"666","cy":"697","r":"10"},
                      {"id":"P_52","cx":"714","cy":"728","r":"10"}
                     ],
             "anchor":"999",
             "altor":"999",
             "coordenadas1":[
                           {"cx":"85","cy":"85"},
                           {"cx":"95","cy":"85"},
                           {"cx":"85","cy":"95"},
                           ],
              "coordenadas2":[
                           {"cx":"95","cy":"105"},
                           {"cx":"85","cy":"115"}
                          ]
            },
            {"datos":[{"id":"P_1","cx":"819","cy":"451","r":"10"},
                      {"id":"P_2","cx":"753","cy":"383","r":"10"},
                      {"id":"P_3","cx":"644","cy":"402","r":"10"},
                      {"id":"P_4","cx":"592","cy":"430","r":"10"},
                      {"id":"P_5","cx":"541","cy":"437","r":"10"},
                      {"id":"P_6","cx":"525","cy":"471","r":"10"},
                      {"id":"P_7","cx":"462","cy":"493","r":"10"},
                      {"id":"P_8","cx":"459","cy":"528","r":"10"},
                      {"id":"P_9","cx":"454","cy":"562","r":"10"},
                      {"id":"P_10","cx":"450","cy":"625","r":"10"},
                      {"id":"P_11","cx":"355","cy":"610","r":"10"},
                      {"id":"P_12","cx":"318","cy":"665","r":"10"},
                      {"id":"P_13","cx":"200","cy":"666","r":"10"},
                      {"id":"P_14","cx":"123","cy":"623","r":"10"},
                      {"id":"P_15","cx":"183","cy":"716","r":"10"},
                      {"id":"P_16","cx":"329","cy":"705","r":"10"},
                      {"id":"P_17","cx":"366","cy":"646","r":"10"},
                      {"id":"P_18","cx":"496","cy":"673","r":"10"},
                      {"id":"P_19","cx":"492","cy":"587","r":"10"},
                      {"id":"P_20","cx":"488","cy":"546","r":"10"},
                      {"id":"P_21","cx":"509","cy":"512","r":"10"},
                      {"id":"P_22","cx":"552","cy":"508","r":"10"},
                      {"id":"P_23","cx":"560","cy":"465","r":"10"},
                      {"id":"P_24","cx":"597","cy":"458","r":"10"},
                      {"id":"P_25","cx":"649","cy":"439","r":"10"},
                      {"id":"P_26","cx":"730","cy":"422","r":"10"}
                    ],
             "anchor":"1000",
             "altor":"1000",
             "coordenadas1":[{"cx":"85","cy":"85"},
                           {"cx":"85","cy":"85"},
                           {"cx":"85","cy":"85"},
                           {"cx":"85","cy":"85"},
                           {"cx":"85","cy":"85"}
                          ],            
             "coordenadas2":[{"cx":"85","cy":"85"},
                           {"cx":"85","cy":"85"},
                           {"cx":"85","cy":"85"},
                           {"cx":"85","cy":"85"},
                           {"cx":"85","cy":"85"}
                          ]
            },
            {"datos":[{"id":"P_53","cx":"181","cy":"634","r":"10"},
                      {"id":"P_54","cx":"188","cy":"667","r":"10"},
                      {"id":"P_41","cx":"235","cy":"640","r":"10"},
                      {"id":"P_55","cx":"207","cy":"610","r":"10"},
                      {"id":"P_56","cx":"201","cy":"588","r":"10"},
                      {"id":"P_57","cx":"198","cy":"561","r":"10"},
                      {"id":"P_58","cx":"190","cy":"537","r":"10"},
                      {"id":"P_59","cx":"185","cy":"498","r":"10"},
                      {"id":"P_60","cx":"220","cy":"500","r":"10"},
                      {"id":"P_61","cx":"860","cy":"496","r":"10"},
                      {"id":"P_62","cx":"189","cy":"459","r":"10"},
                      {"id":"P_63","cx":"145","cy":"461","r":"10"},
                      {"id":"P_64","cx":"159","cy":"520","r":"10"},
                      {"id":"P_65","cx":"164","cy":"550","r":"10"},
                      {"id":"P_66","cx":"176","cy":"580","r":"10"},
                      {"id":"P_67","cx":"178","cy":"609","r":"10"}
                     ],
             "anchor":"1000",
             "altor":"1000",
             "coordenadas1":[{"cx":"183","cy":"612"},
                            {"cx":"193","cy":"659"},
                            {"cx":"221","cy":"660"},
                            {"cx":"238","cy":"647"},
                            {"cx":"232","cy":"604"},
                            {"cx":"211","cy":"603"},
                            {"cx":"185","cy":"474"},
                            {"cx":"239","cy":"477"},
                            {"cx":"239","cy":"462"},
                            {"cx":"220","cy":"358"},
                            {"cx":"247","cy":"303"},
                            {"cx":"482","cy":"246"},
                            {"cx":"607","cy":"233"},
                            {"cx":"663","cy":"280"},
                            {"cx":"667","cy":"474"},
                            {"cx":"736","cy":"462"},
                            {"cx":"766","cy":"512"}
                          ],
             "coordenadas2":[{"cx":"85","cy":"85"},
                            {"cx":"85","cy":"85"},
                            {"cx":"85","cy":"85"},
                            {"cx":"85","cy":"85"},
                            {"cx":"85","cy":"85"}
                          ]
     
            }
          ];

/*
svgobject= datos_graf[0];
 svgobject.data= new Array(5);
svgobject.data[0]=new circulo("P_1",95,70,5);
svgobject.data[1]=new circulo("P_2",115,130,5);
svgobject.data[2]=new circulo("P_3",190,130,5);
svgobject.data[3]=new circulo("P_4",115,180,5);
svgobject.data[4]=new circulo("P_5",153,180,5);
svgobject.anchor=500;
svgobject.altor=500;
activo=[];
//alert(svgobject.anchor)
for (var j=0;j<svgobject.data.length;j++){
activo[j]=1;
}
*/

function circulo(d1,d2,d3,d4){
this.leyenda=d1;
this.centro=[d2,d3];
this.radio=d4;
}

function cambiacolor(e){
var b=document.getElementsByName("r1");
for (var i=0;i<b.length;i++){
if (e===b[i]) {var num=i;break}
}

//var divsvg = document.getElementById("svg");
//divsvg.hidden=true;

muestra_parada2(datos_graf[rutaactiva]["datos"][num]["id"])
console.log(e);
}

function despliega_slider(){
var divslider=document.getElementById("slide");
divslider.hidden=false;
}

function oculta_slider(){
var divslider=document.getElementById("slide");
divslider.hidden=true;
}

vzmax=1.5;
vzmin=0.8;
function redibuja(){
var fuente=rutas[rutaactiva]["id"]+'.jpg';
var vsl=document.getElementById("myRange");
var zoom=((vzmax-vzmin)/(vsl.max-vsl.min))*(vsl.value-vsl.min)+vzmin;
muestrasvg(datos_graf[rutaactiva],parseInt(600*zoom),parseInt(600*zoom),fuente)
}

function muestrasvg(o,ancho,alto,imagen){
var divsvg = document.getElementById("svg");
//divsvg.style="position: fixed; top :100px; height: 70%;left: 0px; width:80% ;background-color: white;color:green; text-align: left; border: 3px solid #73AD21;resize:vertical; overflow-x: scroll;";
divsvg.style="height: 70%; width:100% ;background-color: white;color:green; text-align: left; border: 1px solid #73AD21;resize:vertical; overflow-x: scroll;";

var textoT='';
divsvg.hidden=false;
//divsvg.style.backgroundImage = 'url("'+imagen+'")';
textoT+='<svg position: relative; width="'+ancho+'" height="'+alto+'">';
textoT+='<image id="imag" width="'+ancho+'" height="'+alto+'" href='+imagen+' />';

var n=o.datos.length;
console.log(n);
for (var i=0;i<n;i++) {
var centx=o.datos[i].cx*(ancho/o.anchor);
var centy=o.datos[i].cy*(alto/o.altor);
var radio=o.datos[i].r*(ancho/o.anchor);
console.log(centx+" "+centy+" "+radio);
//textoT+='<circle name="r1"  onclick="cambiacolor(this);" cx="30" cy="30" r="10" />';
textoT+='<circle name="r1" onclick="cambiacolor(this);" cx="'+centx +'" cy="'+centy +'" r="'+radio+'" stroke="black" stroke-width="3" opacity= "1"/>';

}

var n=o.coordenadas1.length;
var color="blue";
for (var i=0;i<n;i++) {
var px=o.coordenadas1[i].cx*(ancho/o.anchor);
var py=o.coordenadas1[i].cy*(ancho/o.anchor);
if (i>0) {
   textoT+='<line x1="'+pxant+'" y1="'+pyant+'" x2="'+px+'" y2="'+ py+'" stroke="'+color+'" stroke-width="3"  />'
}
var pxant=px;
var pyant=py;
}

var n=o.coordenadas2.length;
var color="black";
for (var i=0;i<n;i++) {
var px=o.coordenadas2[i].cx*(ancho/o.anchor);
var py=o.coordenadas2[i].cy*(ancho/o.anchor);
if (i>0) {
   textoT+='<line x1="'+pxant+'" y1="'+pyant+'" x2="'+px+'" y2="'+ py+'" stroke="'+color+'" stroke-width="3"  />'
}
var pxant=px;
var pyant=py;
}


textoT+='</svg>';
textoT+='<br><span id="mleyenda" ></span><br>';
textoT+='<button onclick="quitarsvg();">Ok </button>';
divsvg.innerHTML=textoT;
for (var i=0;i<n;i++) {
  document.getElementsByName("r1")[i].style.fill="black"; 
}

var img = document.getElementById('imag');
    var altoDefinido = img.height; // 300
    var altoOriginal = img.naturalHeight; // 600
    var anchoDefinido = img.width; // 300
    var anchoOriginal = img.naturalWidth; // 600
    console.log(altoDefinido);

}
 function muestraleyenda(e){
document.getElementById("mleyenda").innerHTML=e.title;
}

function quitarsvg(){
var divsvg = document.getElementById("svg");
divsvg.style.display="none";
}

function despliega_imagen_ruta(ruta){
despliega_slider();
rutaactiva=ruta;
console.log('ruta:'+ruta);
var divparada=document.getElementById("parada");
divparada.hidden=true;
var divdisplay=document.getElementById("display");
divdisplay.innerHTML='';
var divhor=document.getElementById("hor");
divhor.hidden=true;

var fuente=rutas[ruta]["id"]+'.jpg';

muestrasvg(datos_graf[ruta],500,500,fuente)

//var texto='<img src="'+rutas[ruta]["id"]+'.jpg" width="100%" height="100%">';
//divdisplay.innerHTML=texto;

}
function quitar(){
var divparada=document.getElementById("parada");
divparada.hidden=true;
}

function muestra_parada2(codpar){
console.log(codpar);
var texto='';
var divparada=document.getElementById("parada");
divparada.style="position: fixed; top :200px;  height: 20%;left: 10px; width:30% ;background-color: white;color:green; text-align: left; ";

//var divruta=document.getElementById("ruta");
//divruta.innerHTML="";
//texto+='<div style="position: fixed; text-align:right;background-color: gray;width:40%;">';
//texto+=' <button  title="Salir" onclick="quitar();" > x </button></div> <br> <br>';

//var divdisplay=document.getElementById("display");
var rutas=paradas.length;
var enc=false;
var k=0;
var np=paradas.length;
while (!enc && k<np){
  if (codpar==paradas[k]["id"]) {enc=true} else {k++}
}
if (enc) {
texto+='<center>'+paradas[k]["nombre"]+'</center>';
var nr=paradas[k]["rutas"].length;
var param=paradas[k]["latitud"]+','+paradas[k]["longitud"];
console.log(param);
//texto+='Ubicacion: <br>'+'Latitud:'+paradas[k]["latitud"]+'<br>';
//texto+='Longitud: '+paradas[k]["longitud"]+'<button onclick="muestra_enlace('+'\''+param+'\''+')"> </button><br>';
//texto+='Longitud: '+grad_min_seg(paradas[k]["longitud"])+'<br>';
for (j=1;j<=nr;j++){
var idruta=getIdRuta(paradas[k]["rutas"][j-1]);
var idt="te_"+(j-1).toString()+"_"+k.toString();
texto+='<p class="parlist" onclick="displayruta('+ idruta +');">'+Nombre_ruta(paradas[k]["rutas"][j-1])+' </p> <span id="'+idt+'"></span>';
}
texto+='<div style="text-align:center;"> <button   title="Salir" onclick="quitar_par2();" > x </button></div>';
}
divparada.innerHTML=texto;
divparada.hidden=false;
}
function quitar_par2(){
var divparada=document.getElementById("parada");
divparada.hidden=true;


}
var latitud;
var longitud;
var id='01';
var fecha;
var tiempo;
var hoy;
var watchID;
var rutas;
var paradas;

function Despliega_Rutas(){
var divdisplay=document.getElementById("display");
var divruta=document.getElementById("ruta");
var divsvg=document.getElementById("svg");
divsvg.hidden=true;
var divparada=document.getElementById("parada");
divparada.hidden=true;
divruta.innerHTML="";
divdisplay.hidden=false;
var texto="<center>";
var nrutas=rutas.length
for (var j=0;j<nrutas;j++){
 texto+='<p class="parlist" onclick="displayruta('+j+')">'+rutas[j]["nombre"]+'</p>'
 console.log(rutas[j]["nombre"]);
}
texto+="</center>";
divdisplay.innerHTML=texto;
}

function Despliega_paradas(){
var divdisplay=document.getElementById("display");
var divruta=document.getElementById("ruta");
var divparada=document.getElementById("parada");
divparada.hidden=true;
divruta.hidden=true;
var divsvg = document.getElementById("svg");
divsvg.style.display="none";

var texto="<center>";
var nparadas=paradas.length
for (var j=0;j<nparadas;j++){
 var codpar=paradas[j]["id"];
 texto+='<p class="parlist" onclick="muestra_parada(\''+codpar+'\')">'+paradas[j]["nombre"]+'</p>'
 console.log(paradas[j]["nombre"]);
}
texto+="</center>";
divdisplay.innerHTML=texto;


}

function getIdRuta(id){
var nr=rutas.length;
var enc=false;
var k=0;
while (!enc && k<nr){
  if (id==rutas[k]["id"]) {enc=true} else {k++}
}
if (enc) { return k; } else {return -1}
}


function Nombre_ruta(id){
console.log('id: '+id);
var nr=rutas.length;
var enc=false;
var k=0;
while (!enc && k<nr){
  if (id==rutas[k]["id"]) {enc=true} else {k++}
}
if (enc) { return rutas[k]["nombre"] } else {return "imnominada"}
}

function Nombre_parada(codpar){
var enc=false;
var k=0;
var np=paradas.length;
while (!enc && k<np){
  if (codpar==paradas[k]["id"]) {enc=true} else {k++}
}
if (enc) { return paradas[k]["nombre"] } else {return "No encontrada" }


}

function muestra_parada(codpar){
console.log(codpar);
var divruta=document.getElementById("ruta");
divruta.innerHTML="";
var divsvg = document.getElementById("svg");
divsvg.hidden=true;
var divdisplay=document.getElementById("display");
var enc=false;
var k=0;
var np=paradas.length;
while (!enc && k<np){
  if (codpar==paradas[k]["id"]) {enc=true} else {k++}
}
if (enc) {
var texto='<center>'+paradas[k]["nombre"]+'</center>';
var nr=paradas[k]["rutas"].length;
var param=paradas[k]["latitud"]+','+paradas[k]["longitud"];
console.log(param);
texto+='Ubicacion: <br>'+'Latitud:'+paradas[k]["latitud"]+'<br>';
texto+='Longitud: '+paradas[k]["longitud"]+'<button onclick="muestra_enlace('+'\''+param+'\''+')"> </button><br>';

//texto+='Longitud: '+grad_min_seg(paradas[k]["longitud"])+'<br>';
texto+='Rutas asociadas:<br>';
for (j=1;j<=nr;j++){
var idruta=getIdRuta(paradas[k]["rutas"][j-1]);
texto+='<p  class="parlist" onclick="displayruta('+ idruta +');">'+Nombre_ruta(paradas[k]["rutas"][j-1])+'  </p> ';
}
}
divdisplay.innerHTML=texto;

}
function muestra_enlace(local){
console.log(local);
//var divdisplay=document.getElementById("display");
//texto='<iframe src="https://maps.google.com/?q='+local+'" style="width: 90%; height: 80%" ></iframe>';
window.open('https://maps.google.com/?q='+local);
//divdisplay.innerHTML=texto;

}
function despliega_paradas_ruta(ruta){
var divdisplay=document.getElementById("display");
var divsvg = document.getElementById("svg");
divsvg.style.display="none";
var divparada=document.getElementById("parada");
divparada.hidden=true;
var divhor=document.getElementById("hor");
divhor.hidden=true;
oculta_slider();
var np=rutas[ruta]["paradas"].length;
var texto="";
for (j=0;j<np;j++){
var codpar=rutas[ruta]["paradas"][j].toString();
console.log(codpar);
texto+='<div class="barra"><p class="parlist" onclick="muestra_parada(\''+codpar+'\');">'+Nombre_parada(rutas[ruta]["paradas"][j])+'</p></div>';
}
divdisplay.innerHTML=texto;
}

function grad_min_seg(num){
var numabs=Math.abs(num);
var grados=Math.trunc(numabs);
var resto=numabs-grados;
var min=Math.trunc(resto*60);
resto=resto*60-min;
var seg=resto*60;
seg =Math.trunc(seg*100)/100;
return grados+'G'+min+'\''+seg+'\'\'';
}

function despliega_horsem(ruta){
var divsvg = document.getElementById("svg");
divsvg.style.display="none";
var divparada=document.getElementById("parada");
divparada.hidden=true;
var divdisplay=document.getElementById("display");
var npu=rutas[ruta]["horariosutiles"].length;
var nps=rutas[ruta]["horariossabados"].length;
var npd=rutas[ruta]["horariosdomingos"].length;
var npu2=rutas[ruta]["horariosutiles2"].length;
var nps2=rutas[ruta]["horariossabados2"].length;
var npd2=rutas[ruta]["horariosdomingos2"].length;

var npm=Math.max(npu,npu2);
var texto='<table id="tabla_h" style="font-size: 60px;"><tr><td colspan="2">Semana</td></tr>';
texto+='<tr><td >'+Nombre_parada(rutas[ruta]["PI"])+'</td><td>'+Nombre_parada(rutas[ruta]["PF"])+'</td ></tr>';
for (j=0;j<npm;j++){
texto+='<tr>';
if (j<npu) {texto+='<td>'+rutas[ruta]["horariosutiles"][j]+'</td>'} else {texto+='<td></td>'}
if (j<npu2) {texto+='<td>'+rutas[ruta]["horariosutiles2"][j]+'</td>'} else {texto+='<td></td>'}
texto+='</tr>';
}
texto+='</table>';
divdisplay.innerHTML=texto;

}
function despliega_horsab(ruta){
var divsvg = document.getElementById("svg");
divsvg.style.display="none";
var divparada=document.getElementById("parada");
divparada.hidden=true;
var divdisplay=document.getElementById("display");
var nps=rutas[ruta]["horariossabados"].length;
var nps2=rutas[ruta]["horariossabados2"].length;

var npm=Math.max(nps,nps2);
var texto='<table id="tabla_h" style="font-size: 60px;"><tr><td colspan="2">Sabado</td></tr>';
texto+='<td >'+Nombre_parada(rutas[ruta]["PI"])+'</td><td>'+Nombre_parada(rutas[ruta]["PF"])+'</td></tr>';
for (j=0;j<npm;j++){
texto+='<tr>';
if (j<nps) {texto+='<td>'+rutas[ruta]["horariossabados"][j]+'</td>'} else {texto+='<td></td>'}
if (j<nps2) {texto+='<td>'+rutas[ruta]["horariossabados2"][j]+'</td>'} else {texto+='<td></td>'}

texto+='</tr>';
}
texto+='</table>';
divdisplay.innerHTML=texto;
}

function despliega_hordom(ruta){
var divsvg = document.getElementById("svg");
divsvg.style.display="none";
var divparada=document.getElementById("parada");
divparada.hidden=true;
var divdisplay=document.getElementById("display");
var npd=rutas[ruta]["horariosdomingos"].length;
var npd2=rutas[ruta]["horariosdomingos2"].length;
var npm=Math.max(npd,npd2);
var texto='<table id="tabla_h" style="font-size: 60px;"><tr><td colspan="2">Domingo</td></tr>';
texto+='<td>'+Nombre_parada(rutas[ruta]["PI"])+'</td><td>'+Nombre_parada(rutas[ruta]["PF"])+'</td></tr>';
for (j=0;j<npm;j++){
texto+='<tr>';
if (j<npd) {texto+='<td>'+rutas[ruta]["horariosdomingos"][j]+'</td>'} else {texto+='<td></td>'}
if (j<npd2) {texto+='<td>'+rutas[ruta]["horariosdomingos2"][j]+'</td>'} else {texto+='<td></td>'}
texto+='</tr>';
}
texto+='</table>';
divdisplay.innerHTML=texto;
}


function displayruta(ruta){
var divdisplay=document.getElementById("display");
divdisplay.innerHTML="";
var divparada=document.getElementById("parada");
divparada.hidden=true;

var divsvg=document.getElementById("svg");
divsvg.hidden=true;

var ind=ruta;
console.log(ind);
var divruta=document.getElementById("ruta");
divruta.hidden=false;
var nparadas=rutas[ind]["paradas"].length;

var texto='<center>'+rutas[ind]["nombre"]+'</center>';
texto+='<button class="btop" onclick="despliega_imagen_ruta('+ind+');"> Mapa </button>';
texto+='<button class="btop" onclick="despliega_paradas_ruta('+ind+');"> Paradas: </button>';
texto+='<button class="btop" onclick="despliega_horario_sel('+ind+');">Horarios</button>';
texto+='<div id="slide" hidden="true"> <input onchange="redibuja();" type="range" min="1" max="100" value="50" class="slider" id="myRange"></div>';
texto+='<div id="hor" style="text-align:center;" hidden="true"><button onclick="despliega_horsem('+ind+');">Semanales </button>';
texto+='<button onclick="despliega_horsab('+ind+');">Sabados </button>';
texto+='<button onclick="despliega_hordom('+ind+');">Domingos </button></div>';
/*
for (var j=0;j<nparadas;j++){
texto+=rutas[ind]["paradas"][j]+'<br>'
console.log(rutas[ind]["paradas"][j]);
}
*/
divruta.innerHTML=texto;
despliega_imagen_ruta(ruta);
//var fuente=rutas[ruta]["id"]+'.jpg';
//muestrasvg(datos_graf[ruta],500,500,fuente);
}
function despliega_horario_sel(ind){
var divhor=document.getElementById("hor");
divhor.hidden=false;
oculta_slider();
}

function procesa_rutas(){

console.log(rutas);
var sel=document.getElementById("select");
for (var j=0;j<rutas.length;j++){
 console.log(rutas[j].nombre);  
var opt = document.createElement("option");
opt.value = j.toString();
opt.text = rutas[j].nombre;
sel.add(opt, null);
}
}

function Pedir_Rutas(){
console.log('paso');
getDataRutas();
getDataParadas();
//getDataGraf();
};

function getDataGraf() {
var myHeaders = new Headers({
  //'Content-Type': 'text/plain',
  'Content-Type': 'application/json',
  'Access-Control-Allow-Origin': '*'
});

//    const corsAnywhere = 'https://cors-anywhere.herokuapp.com/';
    const corsAnywhere ='';

     const yourUrl ='https://bdeabreu66.github.io/bus/datagraf.json';

    fetch(corsAnywhere + yourUrl, { header: myHeaders, method: 'GET', mode: 'cors'}).then(response => {
       //console.log(response.text()); 
       console.log(response.status); 
       //console.log(response.Body.body); 
      if (!response.ok){
            throw new Error('Network response was not ok.');
            //console.log(response);
        }
        response.json().then(function(data) {
        datos_graf=data;
        localStorage.setItem("resp_graf", JSON.stringify(datos_graf));
        console.log(datos_graf);
//        procesa_rutas();
        });
    }).catch(err => {console.log(err);
      datos_graf=JSON.parse(localStorage.resp_graf);  
      console.log('prueba');   
     //procesa_rutas();


});
}


function getDataParadas() {
var myHeaders = new Headers({
  //'Content-Type': 'text/plain',
  'Content-Type': 'application/json',
  'Access-Control-Allow-Origin': '*'
});

//    const corsAnywhere = 'https://cors-anywhere.herokuapp.com/';
    const corsAnywhere ='';

     const yourUrl ='https://bdeabreu66.github.io/bus/paradas.json';

    fetch(corsAnywhere + yourUrl, { header: myHeaders, method: 'GET', mode: 'cors'}).then(response => {
       //console.log(response.text()); 
       console.log(response.status); 
       //console.log(response.Body.body); 
      if (!response.ok){
            throw new Error('Network response was not ok.');
            //console.log(response);
        }
        response.json().then(function(data) {
        paradas=data;
        localStorage.setItem("resp_paradas", JSON.stringify(paradas));
        console.log(paradas);
//        procesa_rutas();
        });
    }).catch(err => {console.log(err);
      paradas=JSON.parse(localStorage.resp_paradas);  
      console.log('prueba');   
     //procesa_rutas();


});
}


function getDataRutas() {
var myHeaders = new Headers({
  //'Content-Type': 'text/plain',
  'Content-Type': 'application/json',
  'Access-Control-Allow-Origin': '*'
});

//    const corsAnywhere = 'https://cors-anywhere.herokuapp.com/';
    const corsAnywhere = '';

     const yourUrl ='https://bdeabreu66.github.io/bus/rutas.json';

    fetch(corsAnywhere + yourUrl, { header: myHeaders, method: 'GET', mode: 'cors'}).then(response => {
       //console.log(response.text()); 
       console.log(response.status); 
       //console.log(response.Body.body); 
      if (!response.ok){
            throw new Error('Network response was not ok.');
            //console.log(response);
        }
        response.json().then(function(data) {
        rutas=data;
        localStorage.setItem("resp_rutas", JSON.stringify(rutas));

        console.log(rutas);
 //       procesa_rutas();
        });
    }).catch(err => {console.log(err);
      rutas=JSON.parse(localStorage.resp_rutas);    

//procesa_rutas();


});
}



function postData() {
var myHeaders = new Headers({
  //'Content-Type': 'text/plain',
  'Content-Type': 'application/json',
  'Access-Control-Allow-Origin': '*'
});

    const corsAnywhere = 'https://cors-anywhere.herokuapp.com/';

     const yourUrl ='bdeabreu.42web.io/guarda.php';

    const form = document.getElementsByName('loginForm');
    const data = new FormData();
    data.append('lat', latitud);
    data.append('long',longitud);
    data.append('id',id);
    data.append('fecha',fecha);
    data.append('tiempo',tiempo);
    console.log(data.get('fecha'));
    fetch(corsAnywhere + yourUrl, { header: myHeaders, method: 'POST', mode: 'cors', body: data}).then(response => {
       //console.log(response.text()); 
       console.log(response.status); 
       //console.log(response.Body.body); 
      if (!response.ok){
            throw new Error('Network response was not ok.');
            //console.log(response);
        }
        response.text().then(function(data) {
        console.log(data);
        });
    }).catch(err => {console.log(err); 
    
});
}

function stop_Reporte(){
navigator.geolocation.clearWatch(watchID);
}

function reportar(x,y){
console.log('paso2');
var divpos=document.getElementById("pos");
divpos.innerHTML="Latitud: "+x+ " Longitud: "+y;

}

</script>
<script>

// Registra el service worker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js').then(function(registration) {
      // Si es exitoso
      console.log('SW registrado correctamente');
    }, function(err) {
      // Si falla
      console.log('SW fallo', err);
    });
  });
}
var myHeaders = new Headers();

var myInit = { mode: 'cors' };

//var nombrepag="https://monitordolarvenezuela.com/monitor-dolar-hoy";
var nombrepag="https://bdeabreu66.github.io/precios/precios.txt";


//fetch(nombrepag,myInit)
//        .then(ajaxPositive)
//        .catch(showError);

function ajaxPositive(response) {
      console.log('response.ok: ', response.ok);
      if(response.ok) {
        response.text().then(showResult);
      } else {
        showError('status code: ' + response.status);
      }
    }
 function showResult(txt) {
        //console.log('muestro respuesta: ', txt);
        localStorage.setItem('data',txt);
        data=eval(txt);
        refresca();
  }

function showError(err) { 
      console.log('muestor error', err);
    }


//Actualiza_dolar();


</script>
</BODY>
</html>