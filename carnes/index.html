<HTML>
<HEAD>
<TITLE>  Precios Carne </TITLE>
<!-- <link rel="stylesheet" href="styles.css" > -->
<!-- <link rel="manifest" href="manifest.json">   -->
<link rel="manifest" href="manifest.json"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
<style>

input[type=number]{
width: 5em;
}

input[type=text]{
font-size:1em;
width: 4em;
border: 2px solid red;
border-radius: 4px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
  background-color: blue;
  color: white;
}

input[type=number]{
font-size:1em;
width: 4em;
border: 2px solid red;
border-radius: 4px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
  background-color: #3CBC8D;
  color: white;
}

input[type=text]:focus {
  background-color: lightblue;
}


</style>

</HEAD>


<BODY onload="inicio();">
<div id="datos"><button onclick="Actualiza_dolar();">A</button><br>
TASA: <input id="tas" oninput="guarda_tasa();" type="number" value="0"> <button onclick="procesar()":>P</button><br>
<button onclick="borrar()":>B</button><br>
Total(Bs): <span id="tot"></span> Total ($): <span id="tot2"></span>
</div>

<div  >
<table>
<tr>
<td>Producto</td>
<td>Precio</td>
<td>M</td></td>
<td>Cantidad</td>
<td>Total ($)</td>
<td>Total (Bs)</td>
</tr>
<tr>
<td><input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(0);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(1);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(2);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(3);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(4);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(5);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(6);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(7);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(8);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"</td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(9);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(10);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""></td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(11);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(12);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(13);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(14);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(15);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(16);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(17);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(18);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(19);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""> </td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(20);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""></td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(21);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
<tr>
<td> <input name="np" type="text" value=""></td>
<td><input name="p" oninput="procesar();" type="number" value="0"></td>
<td><button name="m" onclick="change(22);">Bs</button></td>
<td><input name="c" oninput="procesar();" type="number" value="0"></td>
<td><span name="r"></span></td>
<td><span name="r2"></span></td>
</tr>
</table>
</div>

<button onclick="procesar();">P</button>
 
<!--   -->

<script type="text/javascript">

function guarda_tasa(){
localStorage.setItem("TASACARNE",document.getElementById("tas").value);

}

function change(p){
var o=document.getElementsByName("m")[p];
var pr=document.getElementsByName("p")[p];
var st=document.getElementsByName("r")[p];
var st2=document.getElementsByName("r2")[p];

var t=document.getElementById("tas").value;
if (o.innerText=='Bs') {o.innerText='$';
  pr.value=(parseFloat(pr.value)/parseFloat(t)).toFixed(2);

} else {o.innerText='Bs'
 pr.value=(parseFloat(pr.value)*parseFloat(t)).toFixed(2);


}

procesar();

}
var dolarbcv;
var dolarparalelo;

var cantidades;
var cant;
function inicio(){
try {
document.getElementById("tas").value=localStorage.getItem("TASACARNE"); 
var buffer=localStorage.getItem("DATOS"); 
var buffer2=localStorage.getItem("MONEDAS");
var buffer3=localStorage.getItem("NOMBRES");
var buffer4=localStorage.getItem("CANTIDADES");
var mo=buffer2.split(","); 
var nom=buffer3.split(","); 
var pr=buffer.split(","); cant=buffer4.split(",");

var n=pr.length;
var precios=document.getElementsByName("p");
var monedas=document.getElementsByName("m");
var nombres=document.getElementsByName("np");
cantidades=document.getElementsByName("c");

for (j=0;j<n;j++){ 
precios[j].value=pr[j];
monedas[j].innerText=mo[j];
nombres[j].value=nom[j];
cantidades[j].value=cant[j];

}

}
catch(e) {}
}

function borrar(){

var i;
console.log(cantidades.length);
for (i=0;i<cantidades.length; i++) {
cant[i]=0;
cantidades[i].value="0";


}
}

function procesar(){
var precios=document.getElementsByName("p");
var nombres=document.getElementsByName("np");
var cantidad=document.getElementsByName("c");
var subtotal=document.getElementsByName("r");
var subtotal2=document.getElementsByName("r2");

var n=precios.length;
var moneda=document.getElementsByName("m");
var tasa=parseFloat(document.getElementById("tas").value);
var total=0;
var total2=0;
var buffer="";
var buffer2="";
var buffer3="";
var buffer4="";

for (j=0;j<n;j++){
buffer+=precios[j].value;
buffer2+=moneda[j].innerText;
buffer3+=nombres[j].value;
buffer4+=cantidad[j].value;

if (j!=(n-1)) {buffer+=","; buffer2+=","; buffer3+=",";buffer4+=","}
var tp=(parseFloat(cantidad[j].value)*parseFloat(precios[j].value));
//alert(tp);
if (moneda[j].innerText=='Bs') {tp=tp;
var tpd=tp/tasa;
subtotal[j].innerText=tpd.toFixed(2);
subtotal2[j].innerText=tp.toFixed(2);
total+=tp;
}
if (moneda[j].innerText=='$') {
var tpb;
tpb=tp*tasa;
subtotal[j].innerText=tp.toFixed(2);
subtotal2[j].innerText=tpb.toFixed(2);
total2+=tp;
}
}
localStorage.setItem("DATOS",buffer);
localStorage.setItem("MONEDAS",buffer2);
localStorage.setItem("NOMBRES",buffer3);
localStorage.setItem("CANTIDADES",buffer4);
document.getElementById("tot").innerText=total.toFixed(2)+ ' Bs';
document.getElementById("tot2").innerText=(total2).toFixed(2)+ ' $';

}

 function Actualiza_dolar(){
var nomb="https://s3.amazonaws.com/dolartoday/data.json"
//var myHeaders = new Headers();
var myInit = { mode: 'cors' };

fetch(nomb,myInit)
        .then(ajaxPositiveD)
        .catch(showErrorD);

function ajaxPositiveD(response) {
      console.log('response.ok: ', response.ok);
      if(response.ok) {
        response.json().then(showResultD);
      } else {
        showErrorD('status code: ' + response.status);
      }
    }
 function showResultD(txt) {
       //console.log('muestro respuesta: ', txt.USD.sicad2);
       dolarparalelo=txt.USD.promedio;
       dolarbcv=txt.USD.sicad2;
       document.getElementById("tas").value=dolarbcv;
  }

function showErrorD(err) { 
      console.log('muestor error', err);
    }
}



// Registra el service worker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js').then(function(registration) {
      // Si es exitoso
      console.log('SW registrado correctamente');
    }, function(err) {
      // Si falla
      console.log('SW fallo', err);
    });
  });
}


</script>

</BODY>
</html>