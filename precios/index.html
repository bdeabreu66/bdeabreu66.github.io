<HTML>
<HEAD>
<TITLE>  Precios Polar</TITLE>
<!-- <link rel="stylesheet" href="styles.css" > -->
<link rel="manifest" href="manifest.json"> 

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
<style>

body{
font-size:30px;
}
input[type=number]{
width: 3em;
}


.btop{

font-size:2em;

}

.btn2{

font-size:1em;

}


input[type=text]{
font-size:1em;
width: 8em;
border: 2px solid red;
border-radius: 4px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
  background-color: #3CBC8D;
  color: white;
}

input[type=text]:focus {
  background-color: lightblue;
}

p{
font-size:1.5rem;
background-color:black;
color:white;
padding:0px;
margin:0px;

}
td{
font-size:1.5rem;
padding:5px;
}
table{
margin:0px;
padding:0px;

}

#footer {
  position: fixed;
  left: 0;
  bottom: 0;
  width: 100%;
  background-color: blue;
  color: white;
  text-align: center;
  font-size:0.5em;
}

#header {
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  background-color: blue;
  color: white;
  text-align: center;
  font-size:0.5em;
}
</style>

</HEAD>


<BODY onload="carga();">
<br>
<span id="fecha"> </span>

<table>
<tr><td>Paralelo </td><td><input id="t1" type="text" value="0"></td></tr>
<tr><td>BCV </td><td><input id="t2" type="text" value="0"></td></tr>
</table>
<center>Lista de precios</center>

<div id="divt" >
</div>
<div id="content" hidden="false"></div>
<div id="factura" hidden="true">
<div style="position: fixed; text-align:right;background-color: gray;width:95%;">
  <button style="font-size: 0.9em;" title="Compartir" id="btnc" onclick="compartir();"> C </button> <button  style="font-size: 0.9em;" title="Salir" onclick="quitar();" > x </button>
</div> 

</div>
 <div id="footer"> Dr. Braulio De Abreu. email: brauliodeabreu@gmail.com <br> Tlfs: +58414 4728631 +58412 8552592</div>
 <div id="header"> <button class="btop" onclick="Actualiza_dolar();">A</button>&nbsp&nbsp<button class="btop" onclick="refresca();">P</button>&nbsp&nbsp<button class="btop" onclick="factura();">F</button>&nbsp&nbsp <button class="btop" onclick="anula();">Z</button></div>


<!--   -->

<script type="text/javascript">
var dist="Distribuidora Pita-Orozco"
var hoy=new Date();
function carga(){
data=[];

try {
document.getElementById("t1").value = localStorage.getItem('p1');
document.getElementById("t2").value = localStorage.getItem('p2');
} catch (error) 
{
  console.error(error);

}

try {
data=eval(localStorage.getItem('data'));

} catch (error) 
{
  console.error(error);

}




var fecha=document.getElementById("fecha");
fecha.innerHTML="Fecha: 02/07/2021 v0.0";
divt=document.getElementById("divt");
fiva=7.25;

var j=0;
//var btn=document.getElementById("btnc");
//console.log(btn);
//btn.addEventListener('click', function(){
//     console.log('paso');},false);

//btn.onclick=function(){ console.log('paso');};



/*data=[["Pilsen,Light,Ice, 1/4",36,13.60,0,0,0,"t1"],
      ["Pilsen,Light,Ice, 1/3",24,13.60,0,0,0,"t1"],
      ["Solera 1/4",36,15.20,0,0,0,"t1"],
      ["Solera lata.250 x 24",24,17.6,0,0,0,"t1"],
      ["Solera lata.295 x 24",24,19.2,0,0,0,"t1"],
      ["Solera Nr.12",12,8.8,0,0,0,0,"t1"],
      ["Solera Nr.24",24,17.6,0,0,0,"t1"],
      ["Pilsen,Light,Ice Nr. 12  x 355",12,8.4,0,0,0,"t1"],
      ["Pilsen,Light,Ice Nr. 24  x 355",24,16.8,0,0,0,"t1"],
      ["Pilsen,Light,Ice Lata 295 x 24",24,16.8,0,0,0,"t1"],
      ["Pilsen,Light,Ice Lata 355 x 24",24,20.0,0,0,0,"t1"],
      ["Pilsen,Light,Ice.Lata 250 x 24",24,16.0,0,0,0,"t1"],
      ["Pilsen,Light,Ice.Lata 250 x 12",12,8.0,0,0,0,"t1"],
      ["Carore&ntilde;a",6,31.2,0,0,0,"t1"],
      ["Malta 1/4",36,8.0,1,0,0,"t1"],
      ["Malta Nr/Light.12",12,5.30,1,0,0,"t1"],
      ["Malta Nr/Light.24",24,10.6,1,0,0,"t1"],
      ["Malta Litr&oacute;n",6,11.0,1,0,0,"t1"],
      ["At&uacute;n",35,55.22,0,0,0,"t2"],
      ["Bonito",35,49.94,0,0,0,"t2"],
      ["Chef Oleina de Palma.18 Lt x 1U",1,45.00,0,0,0,"t2"],
      ["Super Oleina de Palma.1 Lt x 12U",12,32.16,0,0,0,"t2"],
      ["Aceite 0.420lt x 24",24,32.16,0,0,0,"t2"],
      ["Mazeite Aceite 1 lt x 12",12,32.64,0,0,0,"t2"],
      ["Arroz Clasico. 1 Kg x 24 ",24,31.20,0,0,0,"t2"],
      ["Arroz Corina. 1 Kg x 24 ",24,21.12,0,0,0,"t2"],
      ["Avena 48 x 100.Bolsa",48,19.2,0,0,0,"t2"],
      ["Avena 30 x 200.Bolsa",30,23.1,0,0,0,"t2"],
      ["Avena 24 x 400.Bolsa",24,36.48,0,0,0,"t2"],
      ["Avena 12 x 800.Bolsa",12,31.56,0,0,0,"t2"],
      ["Avena(Harina).24x 400.Bolsa",24,35.28,0,0,0,"t2"],
      ["Crema/Arroz.24 x 450.Bolsa",24,19.2,0,0,0,"t2"],
      ["Crema/Arroz.12 x 900.Bolsa",12,15.12,0,0,0,"t2"],
      ["Crema/Arroz.24 x 450.Pote",24,25.2,0,0,0,"t2"],
      ["Crema/Arroz.12 x 900.Pote",12,19.8,0,0,0,"t2"],
      ["Crema/Arroz.34 x 225.Bolsa",34,15.3,0,0,0,"t2"],
      ["Detergente liq.BB.1L x 12",12,45.66,1,0,0,"t2"],
      ["Detergente liq.ROPA DELI.510cc x 12",12,25.47,1,0,0,"t2"],
      ["Detergente BB 400g x 30",30,35.15,1,0,0,"t2"],
      ["Detergente BB 900g x 20",30,50.58,1,0,0,"t2"],
      ["Detergente Floral 900g x 20",20,50.58,1,0,0,"t2"], 
      ["Gelatina Golden Fresa 96 gr x 10",10,11.6,1,0,0,"t2"],
      ["Gelatina Golden Kolita 96 gr x 10",10,10.0,1,0,0,"t2"],
      ["Harina Pan.1 k x 20",20,19.8,0,0,0,"t2"],
      ["Harina Pan/Arroz.1 k x 20",20,16.2,0,0,0,"t2"],
      ["Harina Pan/Mezcla cachapas 500g x 12",12,12.6,0,0,0,"t2"],
      ["Jabon Panela.Ext.Limp.250 x 36",36,22.13,1,0,0,"t2"],
      ["Jabon Panela.Floral.200 x 44",44,20.93,1,0,0,"t2"],
      ["Jabon Panela.BEBE.160 x 48",48,23.94,1,0,0,"t2"],
      ["Jabon Polvo.BEBE.400 x 30",30,34.45,1,0,0,"t2"],
      ["Jabon Polvo.BEBE.900 x 20",20,48.92,1,0,0,"t2"],
      ["Suavizante BEBE.950cc x 12U",12,36.05,1,0,0,"t2"],
      ["Suavizante BEBE.530cc x 12U",12,21.58,1,0,0,"t2"],
      ["Jabon Crema Multiuso.250g x 36U",36,52.20,1,0,0,"t2"],
      ["Jabon Crema Multiuso.500g x 18U",18,46.98,1,0,0,"t2"],
      ["Jabon pastilla Multiuso 130g x 42U",42,20.58,1,0,0,"t2"],
      ["KONGA SABOR NARANJA 30gx8x14",14,4.38,1,0,0,"t2"],
      ["KONGA SABOR MORA 30gx8x14",14,4.38,1,0,0,"t2"],
      ["KONGA SABOR LIMON 30gx50",50,15.66,1,0,0,"t2"],
      ["KONGA SABOR NARANJA 30gx50",50,15.66,1,0,0,"t2"],
      ["KONGA SABOR PARCHITA 30gx8x14",14,3.78,1,0,0,"t2"],
      ["Mantequilla Mavesa 5 K x 1.S/S",1,14.92,0,0,0,"t2"],
      ["Mantequilla Mavesa 5 K x 1.C/S",1,14.92,0,0,0,"t2"],
      ["Mantequilla Mavesa 1 K x 6",6,18.9,0,0,0,"t2"],
      ["Mantequilla Mavesa 250 x 24",24,20.4,0,0,0,"t2"],
      ["Mantequilla Mavesa 500 x 12",12,19.44,0,0,0,"t2"],
      ["Mantequilla Nelly 227 x 24",24,15.12,0,0,0,"t2"],
      ["Mantequilla Nelly.454 x 12",12,15.12,0,0,0,"t2"],
      ["Mayonesa(Aderezo).3,6 K x 4",4,66.12,0,0,0,"t2"],
      ["Mayonesa 500g x 12",12,24.84,0,0,0,"t2"],
      ["Mayonesa 175g x 24",24,23.76,0,0,0,"t2"],
      ["Mayonesa limon  445 g x 12",12,24.84,0,0,0,"t2"],
      ["Mayonesa 445g x 12",12,24.84,0,0,0,"t2"],
      ["Mayonesa 910g x 6U",6,23.46,0,0,0,"t2"],
      ["Mezcla/Cachapas.500 x 12",12,12.60,1,0,0,"t2"],
      ["Mermelada Vienesa 240g x 18",18,30.69,1,0,0,"t2"],
      ["Pasta 500g x 12",12,13.56,1,0,0,"t2"],
      ["Pasta 1 K x 12",12,26.28,1,0,0,"t2"],
      ["Pasta Linguini. 1 K x 12",12,26.28,1,0,0,"t2"],
      ["Pepitonas.140g x 35",35,42.22,1,0,0,"t2"],
      ["Rikesa Blanco.200 x 18",18,32.36,1,0,0,"t2"],
      ["Rikesa Trad.300 x 12",12,29.65,1,0,0,"t2"],
      ["Rikesa Tocineta.300 x 12",12,29.65,1,0,0,"t2"],
      ["Rikesa Trad.200 x 18",18,27.90,1,0,0,"t2"],
      ["Sardina/Aceite.170 x 20",20,19.0,1,0,0,"t2"],
      ["Sardina/Tom/Pic.170x 20",20,19.0,1,0,0,"t2"],
      ["Salsa/Tomate.198 x 24",24,15.03,1,0,0,"t2"],
      ["Salsa/Tomate.397 x 24",24,25.06,1,0,0,"t2"],
      ["Salsa/Tomate. 4,2 x 4",4,40.37,1,0,0,"t2"],
      ["Dogourmet Cachorros 18 Kg x 1",1,38.48,1,0,0,"t2"],
      ["Dogourmet Cachorros 2 Kg x 6U",6,33.96,1,0,0,"t2"],
      ["Dogourmet Parrilla. 18 Kg x 1U",1,34.16,1,0,0,"t2"],
      ["Dogourmet Parrilla. 1 Kg x 10U",10,26.8,1,0,0,"t2"],
      ["Dogourmet Parrilla. 2 Kg x 6U",6,30.48,1,0,0,"t2"],
      ["Dogourmet Parrilla. 4 Kg x 5U",5,44.25,1,0,0,"t2"],
      ["Dogourmet Pollo brasa. 4 Kg x 5U",5,44.25,1,0,0,"t2"],
      ["Super Can. carne hueso 2 Kg x 6U",6,17.19,1,0,0,"t2"],
      ["Dogourmet Cachorros 10 Kg x 1U ",1,21.41,1,0,0,"t2"],
      ["Dogourmet Parrilla. 10 Kg x 1U",1,19.53,1,0,0,"t2"],
      ["Super Can. pollo 18 Kg x 1",1,21.75,1,0,0,"t2"],
      ["Super Can.carne hueso 10 Kg x 1",1,12.70,1,0,0,"t2"],
      ["Super Can.carne hueso 18 Kg x 1",1,21.75,1,0,0,"t2"],
      ["Super Can.carne hueso 4 Kg x 5U",5,28.07,1,0,0,"t2"],
      ["Toddy. 2 Kg x 8U. Bolsa",8,110.15,1,0,0,"t2"],
      ["Toddy. 1 Kg x 12U Bolsa",12,88.11,1,0,0,"t2"],
      ["Toddy. 400g x 24U Bolsa",24,79.62,1,0,0,"t2"],
      ["Toddy. 400g x 12U Pote",12,39.81,1,0,0,"t2"],
      ["Toddy. 100g x 36U Bolsa",36,33.83,1,0,0,"t2"],
      ["Toddy. 200g x 12U Pote",12,20.88,1,0,0,"t2"],
      ["Toddy. Galleta. 6 x 6 x 24",24,7.52,1,0,0,"t2"],
      ["Vinagre. 1/2 lt x 24",24,14.20,1,0,0,"t2"],
      ["Vinagre. 1 lt x 12",12,12.53,1,0,0,"t2"],
      ["Vinagre. 4 lt x 4",4,16.56,1,0,0,"t2"],
      ["Yogurt. F y D. 125 x 24",24,27.00,1,0,0,"t2"],
      ["Yogurt. F y D. 250 x 24",24,47.61,1,0,0,"t2"],
      ["Yogurt. F y D. 750 x 12",12,59.86,1,0,0,"t2"],
      ["Yogurt. Migurt 240 x 24",24,39.25,1,0,0,"t2"],
      ];
*/
refresca();
}
function actT(ind){
var valor=prompt("Introduzca cantidad", "");
if (valor!=null) {data[ind][5]=parseInt(valor);}
refresca();
console.log(ind);
}
function actU(ind){
var valor=prompt("Introduzca cantidad", "");
if (valor!=null) {data[ind][4]=parseInt(valor);}
refresca();

console.log(ind);
}
var factflag=true;
function factura(){
if (factflag) {factflag=false; factura2(); } else { factflag=true; quitar()};

}
var Ftexto;

function fecha_actual(){
var mes=(hoy.getMonth()+1).toString();
if (mes.length==1) {mes='0'+mes}
return (hoy.getDate()).toString() + '/' +mes + '/' +hoy.getFullYear().toString()

}
function factura2(){
var texto='Fecha: '+fecha_actual()+'<br>';
texto+=dist+'<br>';
texto+='$ Paralelo: '+  impri(document.getElementById("t1").value) +'<br>';
texto+='$ BCV: '+  impri(document.getElementById("t2").value) +'<br>';
texto+="<center>F&aacute;ctura</center>";
var totald=0;
var totalb=0;
Ftexto='Fecha: '+fecha_actual()+'\n';
Ftexto+=dist+'\n';
Ftexto+='$ Paralelo: '+  impri(document.getElementById("t1").value) +'\n';
Ftexto+='$ BCV: '+  impri(document.getElementById("t2").value) +'\n';
Ftexto+="FACTURA\n"
for (var i=0;i<data.length;i++){
if (data[i][6]=="t1") {factor=t1;}
if (data[i][6]=="t2") {factor=t2;}
var Tdolar=data[i][4]*(data[i][2]/data[i][1]) + data[i][5]*(data[i][2]);
if (Tdolar!=0) { 
  totald+=Tdolar;
  totalb+=factor*Tdolar;
  Ftexto+='------------\n';
  if (data[i][4]!=0) { 
         texto+='<p style=" font-size:0.8em;" >'+ data[i][4] +'U '+ data[i][0]+'</p>';
         Ftexto+=data[i][4] +'U '+ data[i][0]+'\n';
  }
  if (data[i][5]!=0) 
    { texto+='<p style=" font-size:0.8em;" >'+ data[i][5] +'T  ' + data[i][0]+'</p>';
        Ftexto+=data[i][5] +'T '+ data[i][0]+'\n';;
    }
  texto+='<table width="100%"><tr><td>'+impri(Tdolar.toFixed(2))+' $'+'</td><td>'+impri((factor*Tdolar).toFixed(2))+' Bs'+'</td></tr></table>';
   Ftexto+=impri(Tdolar.toFixed(2))+' $'+"    "+impri((factor*Tdolar).toFixed(2))+' Bs'+'\n'


if (data[i][3]==1) { 
  var fr=data[i][5]+ data[i][4]/data[i][1]; 
  texto+='Retencion: '+  impri((fr*data[i][2]/fiva).toFixed(2))+' $ '+impri((fr*data[i][2]*factor/fiva).toFixed(2))+ ' Bs';
  Ftexto+='Retencion: '+  impri((fr*data[i][2]/fiva).toFixed(2))+' $ '+impri((fr*data[i][2]*factor/fiva).toFixed(2))+ ' Bs\n';
}

}
}


texto+='<HR>';
Ftexto+='============================================\n';
texto+='<span style="color:yellow; font-size:1em;">Total: </span>'+impri(totald.toFixed(2))+' $ <br>';
texto+=impri(totalb.toFixed(2))+' Bs';
Ftexto+='Total:'+impri(totald.toFixed(2))+'$ \n'
Ftexto+=impri(totalb.toFixed(2))+' Bs';
console.log(Ftexto);
var textoT="";
divfactura=document.getElementById("factura")
divfactura.style="position: fixed;top :35px; left: 2px; overflow-y: auto; width: 95% ; height: 80%; background-color: green;color:white; border: 3px solid #73AD21;";
//textoT+='<div style="position: fixed; text-align:right;background-color: gray;width:95%;">';
//textoT+=' <button  title="Compartir" id="btn" onclick="compartir();" > C </button> <button  title="Salir" onclick="quitar();" > x </button></div> <br> <br>';
textoT+='<div style="color:black; font-size:0.8em;">'+texto+'</div>';
divfactura.innerHTML+=textoT;
divfactura.hidden=false;
}





function compartir(){
const shareData = {
  title: 'Factura',
  text: Ftexto
}
//console.log(shareData);
comparte(shareData);
}

async function comparte(shareData){
  try {
    await navigator.share(shareData)
    console.log('MDN shared successfully');
  } catch(err) {
    console.log( 'Error: ' + err);
  }
}


function anula(){

for (var i=0;i<data.length;i++){
data[i][4]=0;
data[i][5]=0;
}
refresca();
}

function quitar(){
var div5 = document.getElementById("factura");
div5.hidden=true;
factflag=true;
}

function refresca(){
t1=document.getElementById("t1").value;
t2=document.getElementById("t2").value;
localStorage.setItem('p1',t1);
localStorage.setItem('p2',t2);
texto="";
var factor;
for (var i=0;i<data.length;i++){
if (data[i][6]=="t1") {factor=t1;}
if (data[i][6]=="t2") {factor=t2;}
//console.log(i+" "+data[i][0]);
texto+='<p  >'+ data[i][0]+'</p>';
if (data[i][4]==0) {var vcor='black';} else {var vcor='blue';}
if (data[i][5]==0) {var vcor1='black';} else {var vcor1='blue';}

texto+='<table><tr><td> U '+impri((data[i][2]/data[i][1]).toFixed(2))+' $' +'</td><td>'+ impri(((data[i][2]/data[i][1])*factor).toFixed(2))+ ' Bs <button class="btn2" style="color:'+vcor+';"'+'onclick="actU('+i+');">'+data[i][4]+'</button></td></tr>';
texto+='<tr><td> T '+impri(data[i][2].toFixed(2))+' $'+'</td><td>'+ impri((data[i][2]*factor).toFixed(2))+ ' Bs <button class="btn2" style="color:'+vcor1+';"'+'onclick="actT('+i+');">'+data[i][5]+'</button></td></tr></table>';
   if (data[i][3]==1) {
    texto+="<span style='font-size:0.6em;'>Retenci&oacute;n T: "+impri((data[i][2]/fiva).toFixed(2))+" $ "+impri((data[i][2]*factor/fiva).toFixed(2))+" Bs          </span>";
   }
}
texto+='<br><br>'
divt.innerHTML=texto;
}
function impri(A){
var At=A.toString();
var p=At.indexOf('.');
var num=At.substring(0,p);
var dec=At.substring(p+1,At.length);
//console.log(p+" "+num+" "+dec);
var B="";
var j=0;
var indfin=num.length
var porc=[];
while (indfin>0) {
porc[j]=num.substring(indfin-3,indfin);
indfin=indfin-3;
j=j+1;
}

for(var j=porc.length-1;j>0;j--)
{
B=B+porc[j]+".";
}
B=B+porc[0]+","+dec
//console.log(B);
return B;
}
impri(12356.3478);

</script>
<script>

// Registra el service worker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js').then(function(registration) {
      // Si es exitoso
      console.log('SW registrado correctamente');
    }, function(err) {
      // Si falla
      console.log('SW fallo', err);
    });
  });
}
var myHeaders = new Headers();

var myInit = { mode: 'cors' };

//var nombrepag="https://monitordolarvenezuela.com/monitor-dolar-hoy";
var nombrepag="https://bdeabreu66.github.io/precios/precios.txt";


fetch(nombrepag,myInit)
        .then(ajaxPositive)
        .catch(showError);

function ajaxPositive(response) {
      console.log('response.ok: ', response.ok);
      if(response.ok) {
        response.text().then(showResult);
      } else {
        showError('status code: ' + response.status);
      }
    }
 function showResult(txt) {
        //console.log('muestro respuesta: ', txt);
        localStorage.setItem('data',txt);
        data=eval(txt);
        refresca();
  }

function showError(err) { 
      console.log('muestor error', err);
    }

//async function fetchHtmlAsText(url) {
//    return await (await fetch(url,myInit)).text();
//}

// this is your `load_home() function`

Actualiza_dolar();

function Actualiza_dolar(){
var nomb="https://s3.amazonaws.com/dolartoday/data.json"
//var myHeaders = new Headers();
var myInit = { mode: 'cors' };

fetch(nomb,myInit)
        .then(ajaxPositiveD)
        .catch(showErrorD);

function ajaxPositiveD(response) {
      console.log('response.ok: ', response.ok);
      if(response.ok) {
        response.json().then(showResultD);
      } else {
        showErrorD('status code: ' + response.status);
      }
    }
 function showResultD(txt) {
       console.log('muestro respuesta: ', txt.USD.sicad2);
       document.getElementById("t1").value = txt.USD.promedio;
       document.getElementById("t2").value = txt.USD.sicad2;
       refresca();
  }

function showErrorD(err) { 
      console.log('muestor error', err);
    }

}

//async function loadHome() {
//var nombrepag="https://bdeabreu66.github.io/mgreen/index.html";
//    const contentDiv = document.getElementById("content");
//    const texto = await fetchHtmlAsText(nombrepag);
//    contentDiv.innerHTML =texto; 
//    console.log('paso'+texto);
//}
//loadHome();
</script>
</BODY>
</html>