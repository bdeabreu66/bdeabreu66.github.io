<HTML>
<HEAD>
<TITLE>  Retenciones de Franquiciados de Empresas Polar </TITLE>
<!-- <link rel="stylesheet" href="styles.css" > -->
<link rel="manifest" href="manifest.json">
<!-- <meta charset="iso-8859-1">  -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
<style>

input[type=number]{
font-size:1em;
width: 8em;
border: 2px solid red;
border-radius: 4px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
  background-color: #3CBC8D;
  color: red;

}

input[type=text]{
font-size:1em;
width: 10em;
border: 2px solid red;
border-radius: 4px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
  background-color: white;
  color: black;
}

input[type=email]{
font-size:1em;
width: 8em;
border: 2px solid red;
border-radius: 4px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
  background-color: #3CBC8D;
  color: red;
}

input[type=date]{
font-size:1em;
width: 12em;
border: 2px solid red;
border-radius: 4px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
   background-color: #3CBC8D;
  
  color: black;
}

select{
font-size:1em;
width: 10em;
border: 2px solid red;
border-radius: 8px;
padding: 4px 4px;
  margin: 4px 0;
  box-sizing: border-box;
  background-color: #3CBC8D;
  color: red;
}

input[type=text]:focus {
  background-color: lightblue;
}


</style>
<style>
body {
  font-family: "Lato", sans-serif;
}

.sidenav {
  height: 100%;
  width: 0;
  position: fixed;
  z-index: 1;
  top: 0;
  left: 0;
  background-color: #111;
  overflow-x: hidden;
  transition: 0.5s;
  padding-top: 60px;
  text-align:left;
}

.sidenav a {
  padding: 8px 8px 8px 32px;
  text-decoration: none;
  font-size: 25px;
  color: #818181;
  display: block;

  transition: 0.8s;
}

.sidenav a:hover {
  color: #f1f1f1;
}

.sidenav .closebtn {
  position: absolute;
  top: 0;
  right: 25px;
  font-size: 36px;
  margin-left: 50px;
}

@media screen and (max-height: 450px) {
  .sidenav {padding-top: 15px;}
  .sidenav a {font-size: 18px;}
}

.micro {
   background-image:url(microphone.svg);
   width:30px;
	height:30px;
	font-size:16px;
	padding:0px 0px 0px 0px;
	background-size:30px 30px;
	background-position:-2px 0px;
    fill: green;

border-radius: 8px;
}
.divfondo {
   width:90%;
   background-color:#FFFDD0;
   border-radius: 8px;
padding: 6px 6px;
margin-left: 5px;
margin-right: 5px;
}
.micro:active {
background-color: lightgreen;
}
.btop{
font-size:2em;
border: 2px solid red;
border-radius: 8px;
padding: 4px 4px ;
  margin: 4px 0px ;
  box-sizing: border-box;
  background-color: orange;
  color: black;
}
.btop:active {background-color: lightgreen;}
.titulo{
color:blue;
}
.botonf{
font-size:0.8em;
border: 2px solid red;
border-radius: 4px;
padding: 8px 8px;
  margin: 8px 0;
  box-sizing: border-box;
  background-color: oldlace;
  color: black;
}
.tablefact {
padding: 0px 0px;
margin: 0px 0px;
font-size: 1em;
}
.botonfact{
width:20em;
font-size:0.8em;
text-align:left;
border: 2px solid red;
border-radius: 12px;
padding: 8px 8px;
  margin: 8px 0;
  box-sizing: border-box;
  background-color: #FFFDD0;
  color: black;
}
.botonf:active {background-color: lightgreen;}
.botonfact:active {background-color: lightgreen;}

#divdata {
position:fixed;
top:20px;
height: 90%;
width:95%;
}

#seleccion {
position:fixed;
top:50px;
height: 90%;
width:100%;
hidden:true;
overflow-y: scroll;
}

#configuracion {
top:50px;
position:fixed;
height: 90%;
width:100%;
overflow-y: auto;
hidden:true;
}
#footer {
  display: none;
  position: fixed;
  left: 0;
  bottom: 0;
  width: 100%;
  background-color: blue;
  color: white;
  text-align: center;
  font-size:0.5em;
}
#header {
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  background-color: white;
  color: white;
  text-align: center;
  font-size:0.5em;
}
</style>
</HEAD>

<script type="text/javascript" src="js/jspdfv153.js"></script>
<script type="text/javascript" src="js/FileSaver.js"></script>
<script type="text/javascript" src="js/addimagev153.js"></script>
<script type="text/javascript" src="js/split_text_to_sizev153.js"></script>
<script type="text/javascript" src="js/standard_fonts_metricsv153.js"></script>
<script type="text/javascript" src="js/cell153.js"></script>
<script type="text/javascript" src="js/png.js"></script>
<script type="text/javascript" src="js/png_support.js"></script>
<script type="text/javascript" src="js/zlib.js"></script>
<script type="text/javascript" src="js/selectFile.js"></script>

<script type="text/javascript" src="setlanguage.js"></script>
<script type="text/javascript" src="pdfs.js"></script>
<script type="text/javascript">
var textoreconocido;
function obtenerTexto(indice) {
if ( window.SpeechRecognition || window.webkitSpeechRecognition ) {
// Obtenemos el objeto de reconocimento de texto de forma compatible a diferentes navegadores
reconocimientoTexto = new ( window.SpeechRecognition || window.webkitSpeechRecognition ) ()
reconocimientoTexto.lang='es-Ve'; 
reconocimientoTexto.onerror = function(event) {
 alert("error "+event.error);
 textoreconocido="";
procesar2(indice);
}
reconocimientoTexto.onresult = function(event) {
// Mostramos el texto obtenido
textoreconocido=event.results[0][0].transcript;
console.log(textoreconocido);
procesar2(indice);
}
// Empezamos a reconocer texto
reconocimientoTexto.start();
} else {
alert ('El navegador no soporta reconocimiento de voz' );
}
}

function procesar2(ind){
var num=textoreconocido.split(" ");
var lt=num.length;
var cant='';
for (var i=0;i<lt;i++) {
 cant+=num[i];
}
console.log(cant);
if (ind==1) {divs_datos.getElementsByTagName("input")[1].value=cant;return;}
if (ind==2) {
 divs_datos.getElementsByTagName("input")[2].value=cant.substring(0,2);
 divs_datos.getElementsByTagName("input")[3].value=cant.substring(2);
return;}
 if (ind==3) {divs_datos.getElementsByTagName("input")[4].value=cant;return;}
if (ind==4) {divs_datos.getElementsByTagName("input")[5].value=cant;return;}
if (ind==5) {
 document.getElementById("nret").value=cant;
 set_n_ret();
return;}

}
function openNav() {
var texto='<a class="closebtn" onclick="closeNav()">&times;</a>';
  texto+='<a href="javascript:void(0)">About</a>';
  texto+='<a  href="javascript:void(0)" onclick="closeNav();Configurar();">Configuracion</a>';
  texto+='<a  href="javascript:void(0)" onclick="closeNav();Crea_datos();">Datos de retencion</a>';
  texto+='<a  href="javascript:void(0)" onclick="closeNav();hacerRetencion();">Hacer PDF</a>';
 document.getElementById("mySidenav").innerHTML=texto;
  document.getElementById("mySidenav").style.width = "250px";
}

function closeNav() {
  document.getElementById("mySidenav").style.width = "0";
}
//localStorage.setItem('p3',va);


/*
*/

function quitar(nombdiv){
var div=document.getElementById(nombdiv);
div.hidden=true;
}

function enviar_whatsapp(phone,text){
var url ='https://api.whatsapp.com/send?phone='+phone+'&text='+text;
console.log(url);
window.open(url);
}


function enviar_mail(){
var url ='mailto:brauliodeabreu@gmail.com?subject=Retenciones';
window.open(url);
}

function enviarRetencion(){
var txt;
var aux;
if (TIPO_RET=="0") {txt=LISTA_C;aux=" Cerveceria";} ;
if (TIPO_RET=="1") {txt=LISTA_A;aux=" Alimentos";} 
if (TIPO_RET=="2") {txt=LISTA_P;aux=" Pepsicola";} 
var asunto="?subject=Retencion "+NRO_RET+" "+NOMB_DIST+' '+AGENCIA+aux+"_"+CODIGO;
var adjunto='&attachment=';
console.log(asunto);
var url ='mailto:'+txt+asunto+adjunto;
window.open(url);
}
var TASA_IVA=16;
var FACTOR_RET=0.75;
var divs_datos;
var FECHA_PAGO;
//var NRO_COMPROBANTE;
var PERIODO_FISCAL;
var DIR_FISCAL='Direccion del Franquiciado Tlf 04XX-XXXXXXX';
var RIF_FISCAL='J-XXXXXXXX-X';
var NOMB_DIST='Distribuidora XXXXXXXXX C.A.';
var AGENCIA='AGENCIA GUACARA ';

var data=[];
var datos_ret=[];
var datos_ret_base;
var NRO_RET="982";
var TIPO_RET="0";
var LISTA_A="";
var LISTA_C="";
var NRO_COMPROB;
function fecha_date(f){
var comp=f.split('/');
var sal=comp[2]+'-'+comp[1]+'-'+comp[0];
console.log('sal '+sal)
return sal;
}

function inv_fecha_date(f){
var comp=f.split('-');
var sal=comp[2]+'/'+comp[1]+'/'+comp[0];
console.log('sal2 '+sal);
return sal;
}

function fecha_estandar(f){
  var year=f.getFullYear();
  var mes=f.getMonth();mes++;if (mes<10) {mes='0'+mes}
  var day=f.getDate();if (day<10) {day='0'+day}
return day+'/'+mes+'/'+year;
}

function crea_fecha(fe){
  var comp=fe.split('/');
  var dia=comp[0];
  var mes=comp[1]-1;
  var year=comp[2];
return new Date(year,mes,dia);
}

function year_estandar(f){
  var year=f.split('/')[2];
return year;
}
function mes_estandar(f){
  var mes=f.split('/')[1]; 
//if (mes<10) {mes='0'+mes}
return mes;
}
function fecha_mayor(f1,f2){
var a2=f2.split('/');
var a1=f1.split('/');
 if (a2[2]>a1[2] || (a2[2]==a1[2] && a2[1]>a1[1]) || (a2[2]==a1[2] && a2[1]==a1[1]) && a2[0]>=a1[0]) {return false; } else {return true;}
}
console.log((parseFloat(2718)*FACTOR_RET/100));
 console.log(((2718)*75).toFixed(2));
var Max_L;
var Max_F;
var CODIGO;
function inicio(){
Max_F=7;
Max_L=7;
CODIGO="XXXXXXXXX";
FECHA_PAGO=new Date();
FECHA_PAGO=fecha_estandar(FECHA_PAGO);
fecha_hoy= new Date();
console.log('fecha_hoy '+fecha_hoy);

fecha_hoy=fecha_estandar(fecha_hoy);
console.log('fecha_hoy '+fecha_hoy);
fecha_min=year_estandar(fecha_hoy)+'-01-01';

divs_datos=document.getElementById("divdata");
datos_ret[0]={"fecha":fecha_hoy,"nro_factura":"","nro_control":"-","nro_debito":"","tt":"Compra","nfa":"","C_IVA":"0","C_SIVA":"0"};
datos_ret[1]={"fecha":fecha_hoy,"nro_factura":"","nro_control":"-","nro_debito":"","tt":"Compra","nfa":"","C_IVA":"0","C_SIVA":"0"};
datos_ret[2]={"fecha":fecha_hoy,"nro_factura":"","nro_control":"-","nro_debito":"","tt":"Compra","nfa":"","C_IVA":"0","C_SIVA":"0"};
datos_ret[3]={"fecha":fecha_hoy,"nro_factura":"","nro_control":"-","nro_debito":"","tt":"Compra","nfa":"","C_IVA":"0","C_SIVA":"0"};
datos_ret[4]={"fecha":fecha_hoy,"nro_factura":"","nro_control":"-","nro_debito":"","tt":"Compra","nfa":"","C_IVA":"0","C_SIVA":"0"};
datos_ret[5]={"fecha":fecha_hoy,"nro_factura":"","nro_control":"-","nro_debito":"","tt":"Compra","nfa":"","C_IVA":"0","C_SIVA":"0"};
datos_ret[6]={"fecha":fecha_hoy,"nro_factura":"","nro_control":"-","nro_debito":"","tt":"Compra","nfa":"","C_IVA":"0","C_SIVA":"0"};
datos_ret[7]={"fecha":fecha_hoy,"nro_factura":"","nro_control":"-","nro_debito":"","tt":"Compra","nfa":"","C_IVA":"0","C_SIVA":"0"};

try {
var datos_T=localStorage.getItem('dat_ret');
if (datos_T!=null) {datos_ret=JSON.parse(datos_T)};
} catch {console.log('error')};

try {
var NRO_RET_T=localStorage.getItem('nro_ret');
if (NRO_RET_T!=null) {NRO_RET=NRO_RET_T};

} catch {console.log('error')};

try {
var TIPO_RET_T=localStorage.getItem('tipo_ret');
if (TIPO_RET_T!=null) {TIPO_RET=TIPO_RET_T};
} catch {console.log('error')};

try {
var LISTA_A_T=localStorage.getItem('lista_a');
if (LISTA_A_T!=null) {LISTA_A=LISTA_A_T};
} catch {console.log('error')};

try {
var LISTA_C_T=localStorage.getItem('lista_c');
if (LISTA_C_T!=null) {LISTA_C=LISTA_C_T};
} catch {console.log('error')};

try {
var LISTA_P_T=localStorage.getItem('lista_p');
if (LISTA_P_T!=null) {LISTA_P=LISTA_P_T};
} catch {console.log('error')};
try {
var Max_F_T=localStorage.getItem('max_f');
if (Max_F_T!=null) {Max_F=parseInt(Max_F_T)};
} catch {console.log('error')};

try {
var CODIGO_T=localStorage.getItem('codigo');
if (CODIGO_T!=null) {CODIGO=CODIGO_T};
} catch {console.log('error')};


try {
var FECHA_PAGO_T=localStorage.getItem('fechapago');
} catch {console.log('error')};
if (FECHA_PAGO_T!=null) {FECHA_PAGO=FECHA_PAGO_T};
try {
var DIR_FISCAL_T= localStorage.getItem('dir_fiscal');
if (DIR_FISCAL_T!=null) {DIR_FISCAL=DIR_FISCAL_T};

var RIF_FISCAL_T= localStorage.getItem('rif_fiscal');
if (RIF_FISCAL_T!=null) {RIF_FISCAL=RIF_FISCAL_T};

var NOMB_DIST_T= localStorage.getItem('nombre_dist');
if (NOMB_DIST_T!=null) {NOMB_DIST=NOMB_DIST_T};

} catch {console.log('error')}

try {
TASA_IVA= localStorage.getItem('tasa_iva');
 if (TASA_IVA==null) {TASA_IVA=16;} 
FACTOR_RET= parseFloat(localStorage.getItem('factor_ret'));
 if (FACTOR_RET==null) {FACTOR_RET=0.75;} 

} catch {console.log('error')}
console.log(TASA_IVA);

document.getElementById("seleccion").hidden=true;
document.getElementById("configuracion").hidden=true;
console.table(FECHA_PAGO);
Seleccion();
}
function retencion(){
var ok1=false;
var ok2=true;

var mensaje='';
for (var i=0;i<Max_F;i++){
 if ((datos_ret[i]["C_IVA"]!='') && (parseFloat(datos_ret[i]["C_IVA"]) !=0) ) {
  ok1=true;
  if (datos_ret[i]["nro_factura"]=='')  {ok2=false; mensaje+=" Falta el nro de factura en la factura "+(i+1)+'\n';}
  if (datos_ret[i]["nro_control"]=='-')  {ok2=false; mensaje+=" Falta el nro de control en la factura "+(i+1)+'\n';}
  if (fecha_mayor(datos_ret[i]["fecha"],FECHA_PAGO)) {ok2=false; mensaje+=" La fecha de la factura "+(i+1)+' es posterior a la fecha de pago \n';}

 }  
}
var ok=ok1 && ok2;
if (!ok1) {mensaje+=" No hay facturas con monto base imponible a IVA distinto de 0 \n";}
if (ok) {hacerRetencion();} else {alert("\u2639\uFE0F"+mensaje);}
}
function copia(j){
divs_datos.getElementsByTagName("input")[0].value=fecha_date(datos_ret[j-1]["fecha"]);
divs_datos.getElementsByTagName("input")[1].value=datos_ret[j-1]["nro_factura"];
divs_datos.getElementsByTagName("input")[2].value=datos_ret[j-1]["nro_control"].substring(0,2);
divs_datos.getElementsByTagName("input")[3].value=datos_ret[j-1]["nro_control"].substring(3);
divs_datos.getElementsByTagName("input")[4].value=datos_ret[j-1]["nro_debito"];
}


function Agregar_datos(m){
fecha_max=fecha_date(FECHA_PAGO);
console.log('fmax '+fecha_max);
var divpart=divs_datos;
var texto='';
var ta='';
texto+='<h4 align="center"> Factura '+(m+1).toString()+'</h4>';
texto+='<div class="divfondo">';
texto+='<span class="titulo">Fecha de la Factura:</span><br> <input type="date" min="'+fecha_min+'" max="'+fecha_max+'" value="'+fecha_date(datos_ret[m]["fecha"])+'">';
if (m>0) {texto+='&nbsp;&nbsp;&nbsp;<button title="copiar de factura anterior" onclick="copia('+m+');"> Copiar anterior </button><br>';} else {texto+='<br>';}
//texto+='Nro de factura (afectada <input type="checkbox">):<br> <input type="number" value="'+datos_ret[m]["nro_factura"]+'"><br> ';
texto+='<span class="titulo">N&deg; de factura:</span><br> <input type="number" value="'+datos_ret[m]["nro_factura"]+'">';
texto+='&nbsp; <button class="micro" onclick="obtenerTexto(1);">&nbsp;</button><br> ';
var tmp=datos_ret[m]["nro_control"].split('-');

var pa=tmp[0];
var pb;
console.log('long '+tmp.length);
if (tmp.length==2) { pb=tmp[1];} else pb='';

//texto+='<span class="titulo">N&deg; de Control:</span><br> <input type="number" style="width:2em;" value="'+datos_ret[m]["nro_control"]+'"><br> ';
texto+='<span class="titulo">N&deg;de Control:</span><br> <input type="number" style="width:3em;" value="'+pa+'">-<input type="number" value="'+pb+'"> ';
texto+='&nbsp; <button class="micro" onclick="obtenerTexto(2);">&nbsp;</button><br> ';

texto+='<span class="titulo">Nota de debito:</span><br> <input type="number" value="'+datos_ret[m]["nro_debito"]+'"> ';
texto+='&nbsp; <button class="micro" onclick="obtenerTexto(3);">&nbsp;</button><br> ';

texto+='<span class="titulo">Monto Base imponible a IVA:</span><br> <input type="number" value="'+datos_ret[m]["C_IVA"]+'"> ';
texto+='&nbsp; <button class="micro" onclick="obtenerTexto(4);">&nbsp;</button><br> ';
texto+='</div>';
//texto+='Monto no sujeto a IVA:<br> <input type="text" value="'+datos_ret[m]["C_SIVA"]+'"><br> ';
texto+='<button class="botonf" onclick="guarda_datos('+m+')";>Guardar</button>';
texto+=' <button class="botonf" onclick="canceladatos();">Cancelar</button>';
texto+=' <button class="botonf" onclick="anular('+m+');">Anular</button><br>'
console.log(texto);
divpart.innerHTML=texto;
divpart.hidden=false;
//divpart.style='position:fixed;top:50px;height: 60%;width:95%;';
document.getElementById("seleccion").hidden=true;
}

function carga_data(){
var narch=document.getElementById("nombarch").value;
if (narch.length>0) {
 descarga_configuracion(narch) ;
}
}

function Configurar(){
var divconf=document.getElementById("configuracion");
var texto='';
texto+='<div class="divfondo">';
texto+='<span class="titulo">Tasa del IVA(%):</span><br> <input type="number" value="'+TASA_IVA+'"><br>';
texto+='<span class="titulo">Fracci&oacute;n de retenci&oacute;n:</span> <br><input type="number" value="'+FACTOR_RET+'"><br>';
texto+='<span class="titulo">M&aacute;ximo de facturas (1-7):</span> <br><input type="number" value="'+Max_F+'"><br>';
texto+='</div>';
texto+='<span class="titulo">Archivo de datos: </span><br> <input id="nombarch" type="text" > <button class="botonf" onclick="carga_data()"> Descargar </button><br>';
texto+='<span class="titulo">Rif:</span><br> <span id="sal1"></span><br>';
texto+='<span style="color:blue;">Nombre:</span><br> <span id="sal2"></span><br>';
texto+='<span style="color:blue;">Direccion:</span><br> <span id="sal3"></span><br>';
texto+='<span style="color:blue;">C&oacute;digo:</span><br> <span id="codigo"></span><br>';
texto+='<span style="color:blue;">Correos para Cervecer&iacute;a: </span><br> <span id="lista_c"></span><br> ';
texto+='<span style="color:blue;">Correos para Alimentos: </span><br> <span id="lista_a"></span><br> ';
texto+='<span style="color:blue;">Correos para PepsiCola: </span><br> <span id="lista_p"></span><br> ';
texto+='<button class="botonf" onclick="guardaconfig();">Guardar</button> <button class="botonf" onclick="cancelaconfig();">Cancelar</button> ';
texto+='<div> <center><h5> Para informaci&oacute;n adicicional y configuraci&oacute;n, escribe al whatsapp <br>';
var numero='584144728631';
var tex='\'\'';
texto+='Braulio De Abreu <button onclick="enviar_whatsapp('+numero+','+tex+');">0414-4728631</button></h5>email: <button onclick="enviar_mail();"> brauliodeabreu@gmail.com </button> </center></div>';
divconf.innerHTML=texto;
divconf.hidden=false;
document.getElementById("seleccion").hidden=true;
document.getElementById("divdata").hidden=true;
document.getElementById("sal1").innerText=RIF_FISCAL;
document.getElementById("sal2").innerText=NOMB_DIST;
document.getElementById("sal3").innerText=DIR_FISCAL;
document.getElementById("lista_a").innerText=lineas(LISTA_A);
document.getElementById("lista_c").innerText=lineas(LISTA_C);
document.getElementById("lista_p").innerText=lineas(LISTA_P);
document.getElementById("codigo").innerText=CODIGO;
}

function set_n_ret(){
NRO_RET=document.getElementById("nret").value;
localStorage.setItem('nro_ret',NRO_RET);
}
function set_t_ret(){
if (document.getElementById("t1").checked==true) {TIPO_RET="0";} 
if (document.getElementById("t2").checked==true) {TIPO_RET="1";}
if (document.getElementById("t3").checked==true) {TIPO_RET="2";}
localStorage.setItem('tipo_ret',TIPO_RET);
}
function set_fecha_pago(){
FECHA_PAGO=inv_fecha_date(document.getElementById("fechapago").value);
localStorage.setItem('fechapago',FECHA_PAGO);
}

function anular(m){
divs_datos.getElementsByTagName("input")[0].value=fecha_date(fecha_hoy);
divs_datos.getElementsByTagName("input")[1].value='';
divs_datos.getElementsByTagName("input")[2].value='';
divs_datos.getElementsByTagName("input")[3].value='';
divs_datos.getElementsByTagName("input")[4].value='';
divs_datos.getElementsByTagName("input")[5].value='';
}

function Seleccion(){
var divsel=document.getElementById("seleccion");
var texto='';
texto+='<center>';
texto+='<h4>Retenciones para Franquiciados de Empresas Polar</h4>';
if (TIPO_RET=="0") {texto+='Cervecer&iacute;a <input type="radio" id="t1" name="tipo" onchange="set_t_ret();" checked>&nbsp;&nbsp;&nbsp;';
 texto+=' Alimentos <input type="radio" id="t2" name="tipo" onchange="set_t_ret();">&nbsp;&nbsp;&nbsp; ';
 texto+=' Pepsicola <input type="radio" id="t3" name="tipo" onchange="set_t_ret();"> <br>';
}
if (TIPO_RET=="1") {texto+='Cervecer&iacute;a <input type="radio" id="t1" name="tipo" onchange="set_t_ret();">&nbsp;&nbsp;&nbsp;';
 texto+=' Alimentos <input type="radio" id="t2" name="tipo" onchange="set_t_ret();" checked>&nbsp;&nbsp;&nbsp; ';
 texto+=' Pepsicola <input type="radio" id="t3" name="tipo" onchange="set_t_ret();"> <br>';
}
if (TIPO_RET=="2") {texto+='Cervecer&iacute;a <input type="radio" id="t1" name="tipo" onchange="set_t_ret();">&nbsp;&nbsp;&nbsp;';
 texto+=' Alimentos <input type="radio" id="t2" name="tipo" onchange="set_t_ret();" > &nbsp;&nbsp;&nbsp;';
 texto+=' Pepsicola <input type="radio" id="t3" name="tipo" onchange="set_t_ret();" checked> <br>';
}

texto+='</center><br>';
texto+='<div class="divfondo">';
texto+='<span class="titulo"> N&deg;de la retenci&oacute;n </span><br><input id="nret" type="number" onchange="set_n_ret();" value="'+NRO_RET+'"> ';
texto+='&nbsp; <button class="micro" onclick="obtenerTexto(5);">&nbsp;</button><br> ';
texto+='<span class="titulo">Fecha de la retenci&oacute;n </span><br><input id="fechapago" type="date" min="'+fecha_min+'"onchange="set_fecha_pago();" value="'+fecha_date(FECHA_PAGO)+'"> ';
texto+='</div>';
texto+='<br><span class="titulo" > Datos de las facturas:</span><br>';
for (var i=0;i<Max_F;i++) {
texto+='<button class="botonfact" onclick="Agregar_datos('+i+');">';
texto+='<table class="tablefact">';
texto+='<tr><td> Fecha: '+ datos_ret[i]["fecha"]+'</td><td>N&deg; '+datos_ret[i]["nro_factura"]+'</td>';
texto+='</tr>';
texto+='<tr><td> N&deg; C: '+datos_ret[i]["nro_control"]+'</td><td> N&deg; D:' +datos_ret[i]["nro_debito"]+'</td>';
texto+='</tr>';
texto+='<tr><td colspan="2" > Monto: '+datos_ret[i]["C_IVA"]+'</td>';
texto+='</tr>';

texto+='</table>';
texto+='</button>';

texto+='&nbsp;<button  style="font-size:1.5em; border-radius: 6px;" onclick="Agregar_datos('+i+');">'+' F'+(i+1).toString()+'</button>'
}
texto+='<br><button class="botonf" onclick="reinicio()";>Reiniciar</button>';

divsel.innerHTML=texto;
divsel.hidden=false;
}
function reinicio(){
var i;
for (i=0;i<7;i++){
datos_ret[i]["fecha"]=fecha_hoy;
datos_ret[i]["nro_factura"]='';
datos_ret[i]["nro_control"]='-';
datos_ret[i]["nro_debito"]='';
datos_ret[i]["C_IVA"]='';
}
NRO_RET=(parseInt(NRO_RET)+1).toString();
FECHA_PAGO=fecha_hoy;
localStorage.setItem("dat_ret",JSON.stringify(datos_ret));
localStorage.setItem('fechapago',FECHA_PAGO);
localStorage.setItem('nro_ret',NRO_RET);
Seleccion();
}
function guardaconfig(){
var div_config=document.getElementById("configuracion");
TASA_IVA=div_config.getElementsByTagName("input")[0].value;
FACTOR_RET=div_config.getElementsByTagName("input")[1].value;
Max_F=parseInt(div_config.getElementsByTagName("input")[2].value);
console.log(Max_F);
if (Max_F>Max_L) {Max_F=Max_L;}
if (Max_F<1) {Max_F=1;}

localStorage.setItem('tasa_iva',TASA_IVA);
localStorage.setItem('factor_ret',FACTOR_RET);
localStorage.setItem('dir_fiscal',DIR_FISCAL);
localStorage.setItem('rif_fiscal',RIF_FISCAL);
localStorage.setItem('nombre_dist',NOMB_DIST);
localStorage.setItem('lista_a',LISTA_A);
localStorage.setItem('lista_c',LISTA_C);
localStorage.setItem('lista_p',LISTA_P);
localStorage.setItem('max_f',Max_F.toString());
localStorage.setItem('codigo',CODIGO);

document.getElementById("configuracion").hidden=true;
Seleccion();
}

function cancelaconfig(){
document.getElementById("configuracion").hidden=true;
document.getElementById("seleccion").hidden=false;
}
function guarda_datos(m){
 var fi=divs_datos.getElementsByTagName("input")[0].value;
 console.log(fi);
 datos_ret[m]["fecha"]=inv_fecha_date(fi);
 datos_ret[m]["nro_factura"]=divs_datos.getElementsByTagName("input")[1].value;
 datos_ret[m]["nro_control"]=divs_datos.getElementsByTagName("input")[2].value+"-"+divs_datos.getElementsByTagName("input")[3].value;
 datos_ret[m]["nro_debito"]=divs_datos.getElementsByTagName("input")[4].value;
 datos_ret[m]["C_IVA"]=(divs_datos.getElementsByTagName("input")[5].value).replace(',','.');
//if (isNaN(parseFloat(datos_ret[m]["C_IVA"]))) {datos_ret[m]["C_IVA"]="0"}
//datos_ret[m]["C_SIVA"]=(divs_datos.getElementsByTagName("input")[4].value).replace(',','.');
//console.log(parseFloat(datos_ret[m]["C_IVA"]));
divs_datos.hidden=true;
console.log(m);
console.table(datos_ret);
localStorage.setItem("dat_ret",JSON.stringify(datos_ret));

Seleccion();
//console.table(
}

function canceladatos(m){
 divs_datos.hidden=true;
console.log(m);
console.table(datos_ret);
Seleccion();
//console.table(
localStorage.setItem("dat_ret",JSON.stringify(datos_ret));
}

function lineas(t){
var l=t.split(";");
return l.join("\n");
}
function descarga_configuracion(name){
var nomb="https://bdeabreu66.github.io/ret_malta/"+name+".txt";
//var myHeaders = new Headers();
var myInit = { mode: 'cors' };
fetch(nomb,myInit)
        .then(ajaxPositiveD)
        .catch(showErrorD);

function ajaxPositiveD(response) {
      console.log('response.ok: ', response.ok);
      if(response.ok) {
        response.json().then(showResultD);
      } else {
        showErrorD('status code: ' + response.status);
      }
    }
 function showResultD(txt) {
       console.log('muestro respuesta: ', txt);
        DIR_FISCAL=txt.dir;
        RIF_FISCAL=txt.rif;
        NOMB_DIST=txt.nombre_C;
        LISTA_A=txt.lista_a;
        LISTA_C=txt.lista_c;
        LISTA_P=txt.lista_p;
        CODIGO=txt.codigo;
        document.getElementById("sal1").innerText=RIF_FISCAL;
        document.getElementById("sal2").innerText=NOMB_DIST;
        document.getElementById("sal3").innerText=DIR_FISCAL;
        document.getElementById("lista_a").innerText=lineas(LISTA_A);
        document.getElementById("lista_c").innerText=lineas(LISTA_C);
        document.getElementById("lista_p").innerText=lineas(LISTA_P);
        document.getElementById("codigo").innerText=CODIGO; 

 }
function showErrorD(err) { console.log('muestor error', err); }

}

// Registra el service worker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js').then(function(registration) {
      // Si es exitoso
      console.log('SW registrado correctamente');
    }, function(err) {
      // Si falla
      console.log('SW fallo', err);
    });
  });
}

</script>

<BODY onload="inicio();">
<!-- <div id="encabezado" style="text-align: left; border: 1px solid #999999; position: fixed;" >  -->
<!--<span style="font-size:30px;cursor:pointer; margin-left: 0px;text-align: left;" onclick="openNav()">&#9776; Menu </span>  -->
<!--</div>  -->
<div id="mySidenav" class="sidenav" ></div>

<div id="divdata"></div>
<div id="seleccion">

</div>
<div id="configuracion">
 
</div>
<div id="header"> <button class="btop" onclick="Configurar();">Configurar</button>&nbsp&nbsp<button class="btop" onclick="retencion();"> Realizar Retenci&oacute;n</button>&nbsp&nbsp<button class="btop" onclick="enviarRetencion();">Enviar Retenci&oacute;n</button>
</div>
</body>
</html>
